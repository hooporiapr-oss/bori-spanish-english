<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
<title>RITNOME CONGA | Hey Bori</title>
<link rel="icon" type="image/png" href="favicon.png">
<link rel="preconnect" href="https://fonts.googleapis.com">
<link href="https://fonts.googleapis.com/css2?family=Bebas+Neue&family=Outfit:wght@400;600;700;800&display=swap" rel="stylesheet">
<style>
:root{
--gold:#FFD700;--orange:#FF6B35;--hot-pink:#FF1493;--teal:#00D9D9;--sunset:#FF8C42;
--deep-purple:#2D1B4E;--dark:#0a0a0f;--card:#111118;--text:#FFFFFF;--muted:#8892a0;
--border:rgba(255,255,255,0.1);--nav-height:50px;--cream:#FFF8E7
}
*{margin:0;padding:0;box-sizing:border-box}
html,body{height:100%;overflow:hidden;font-family:'Outfit',sans-serif;background:linear-gradient(135deg,#0a0a0f 0%,var(--deep-purple) 50%,#1a0a2e 100%);color:var(--cream);touch-action:manipulation;-webkit-tap-highlight-color:transparent;-webkit-user-select:none;user-select:none}
.mini-nav{position:fixed;top:0;left:0;right:0;background:rgba(10,10,15,0.95);border-bottom:1px solid var(--border);padding-top:env(safe-area-inset-top);z-index:1000;backdrop-filter:blur(10px)}
.nav-row{display:flex;align-items:center;justify-content:space-between;height:50px;padding:0 12px}
.back-btn{display:flex;align-items:center;gap:6px;padding:8px 12px;background:transparent;border:1px solid var(--border);color:var(--muted);border-radius:8px;font-family:'Outfit',sans-serif;font-size:0.75rem;font-weight:600;cursor:pointer;text-decoration:none;transition:all 0.2s}
.back-btn:active{border-color:var(--gold);color:var(--gold)}
.nav-title{font-family:'Bebas Neue',sans-serif;font-size:1.1rem;letter-spacing:2px;color:var(--gold)}
.nav-right{display:flex;align-items:center;gap:8px}
.nav-icon-btn{width:36px;height:36px;border-radius:50%;border:1.5px solid rgba(255,215,0,0.3);background:rgba(0,0,0,0.4);color:var(--gold);font-size:1rem;cursor:pointer;display:flex;align-items:center;justify-content:center;-webkit-tap-highlight-color:transparent}
.nav-icon-btn:active{background:rgba(255,215,0,0.2);transform:scale(0.9)}
.container{max-width:500px;margin:0 auto;padding:calc(var(--nav-height) + env(safe-area-inset-top)) 12px 0;height:100dvh;display:flex;flex-direction:column;overflow:hidden}
.bori-hero{text-align:center;padding:0;position:relative}
.bori-hero-img{width:120px;height:auto;filter:drop-shadow(0 8px 24px rgba(147,51,234,.4));margin-bottom:2px;border:none;outline:none;clip-path:inset(0 0 0 1px)}
.bori-hero-title{font-family:'Bebas Neue',sans-serif;font-size:2rem;letter-spacing:6px;background:linear-gradient(135deg,var(--gold),var(--orange),var(--hot-pink),var(--gold));background-size:300% auto;-webkit-background-clip:text;-webkit-text-fill-color:transparent;background-clip:text;animation:shimmer 3s linear infinite;line-height:1}
.bori-hero-sub{font-size:12px;font-weight:700;color:rgba(255,255,255,.35);letter-spacing:3px;text-transform:uppercase;margin-top:2px}
@keyframes shimmer{0%{background-position:200% center}100%{background-position:-200% center}}
.drum-toggle{display:flex;justify-content:center;gap:0;margin:4px 0 2px}
.drum-toggle-btn{padding:7px 16px;border:2px solid rgba(255,215,0,0.3);background:transparent;color:var(--cream);font-family:'Bebas Neue',sans-serif;font-size:0.75rem;letter-spacing:1px;cursor:pointer;transition:all 0.2s}
.drum-toggle-btn:first-child{border-radius:20px 0 0 20px;border-right:none}
.drum-toggle-btn:last-child{border-radius:0 20px 20px 0}
.drum-toggle-btn.active{background:rgba(255,215,0,0.15);border-color:var(--gold);color:var(--gold)}
.game-area{flex:1;display:flex;flex-direction:column;align-items:center;justify-content:center;padding:0;overflow:hidden}
.conga-row{display:grid;grid-template-columns:repeat(3,1fr);grid-template-rows:repeat(3,1fr);gap:10px;padding:15px;width:300px;height:300px;margin:0 auto;position:relative}
.conga-row.three-drums{width:260px;height:200px;grid-template-columns:repeat(3,1fr);grid-template-rows:1fr}
.conga-row.three-drums .tap-conga{width:75px;height:95px}
.conga-row.three-drums .tap-conga:nth-child(4),.conga-row.three-drums .tap-conga:nth-child(5){display:none}
.conga-row.three-drums .tap-conga:nth-child(1){grid-area:1/1}
.conga-row.three-drums .tap-conga:nth-child(2){grid-area:1/2}
.conga-row.three-drums .tap-conga:nth-child(3){grid-area:1/3}
.tap-conga{width:75px;height:95px;background:linear-gradient(180deg,#8B6914 0%,#6B4E0A 50%,#4A3506 100%);border-radius:40% 40% 35% 35% / 25% 25% 40% 40%;position:relative;opacity:0.8;transition:all 0.15s;box-shadow:inset 0 -8px 15px rgba(0,0,0,0.4),inset 0 2px 5px rgba(255,255,255,0.1),0 4px 12px rgba(0,0,0,0.4);cursor:pointer;border:none;outline:none;-webkit-tap-highlight-color:transparent;justify-self:center;align-self:center}
.tap-conga:nth-child(1){grid-area:1/1;--conga-color:#FFD700;--conga-glow:rgba(255,215,0,0.6)}
.tap-conga:nth-child(2){grid-area:1/3;--conga-color:#FF6B35;--conga-glow:rgba(255,107,53,0.6)}
.tap-conga:nth-child(3){grid-area:2/2;--conga-color:#FF1493;--conga-glow:rgba(255,20,147,0.6)}
.tap-conga:nth-child(4){grid-area:3/1;--conga-color:#00D9D9;--conga-glow:rgba(0,217,217,0.6)}
.tap-conga:nth-child(5){grid-area:3/3;--conga-color:#9B59B6;--conga-glow:rgba(155,89,182,0.6)}
.tap-conga:nth-child(1){box-shadow:inset 0 -8px 15px rgba(0,0,0,0.4),0 0 15px rgba(255,215,0,0.2),0 4px 12px rgba(0,0,0,0.4)}
.tap-conga:nth-child(2){box-shadow:inset 0 -8px 15px rgba(0,0,0,0.4),0 0 15px rgba(255,107,53,0.2),0 4px 12px rgba(0,0,0,0.4)}
.tap-conga:nth-child(3){box-shadow:inset 0 -8px 15px rgba(0,0,0,0.4),0 0 15px rgba(255,20,147,0.2),0 4px 12px rgba(0,0,0,0.4)}
.tap-conga:nth-child(4){box-shadow:inset 0 -8px 15px rgba(0,0,0,0.4),0 0 15px rgba(0,217,217,0.2),0 4px 12px rgba(0,0,0,0.4)}
.tap-conga:nth-child(5){box-shadow:inset 0 -8px 15px rgba(0,0,0,0.4),0 0 15px rgba(155,89,182,0.2),0 4px 12px rgba(0,0,0,0.4)}
.tap-conga::before{content:'';position:absolute;top:0;left:50%;transform:translateX(-50%);width:90%;height:28%;background:linear-gradient(180deg,#D4BC8A 0%,#B8A070 100%);border-radius:50%;box-shadow:inset 0 2px 4px rgba(255,255,255,0.3),inset 0 -2px 4px rgba(0,0,0,0.2);pointer-events:none}
.tap-conga::after{content:'';position:absolute;top:6%;left:50%;transform:translateX(-50%);width:60%;height:12%;background:radial-gradient(ellipse,rgba(255,255,255,0.4) 0%,transparent 70%);border-radius:50%;pointer-events:none}
.tap-conga.tapped{opacity:1;transform:scale(1.15) translateY(-4px);box-shadow:0 0 40px var(--conga-glow),0 0 60px var(--conga-glow),0 8px 20px rgba(0,0,0,0.4)}
.tap-conga.lit{opacity:1;transform:scale(1.2) translateY(-5px);background:linear-gradient(180deg,#FFD700 0%,#FF8C42 50%,#E65C00 100%);box-shadow:0 0 30px var(--gold),0 0 50px var(--orange),0 8px 20px rgba(255,107,53,0.6)}
.tap-conga.lit::before{background:linear-gradient(180deg,#FFF8E7 0%,#FFE4A0 100%);box-shadow:0 0 15px rgba(255,215,0,0.5)}
.tap-conga.hit-correct{animation:hitCorrect 0.2s ease-out}
.tap-conga.hit-wrong{animation:hitWrong 0.3s ease-out}
@keyframes hitCorrect{0%{transform:scale(1.2) translateY(-5px)}50%{transform:scale(1.4) translateY(-10px)}100%{transform:scale(1.2) translateY(-5px)}}
@keyframes hitWrong{0%,100%{transform:translateX(0)}20%{transform:translateX(-6px)}40%{transform:translateX(6px)}60%{transform:translateX(-4px)}80%{transform:translateX(4px)}}
.tap-conga:active{transform:scale(0.95)}
.conga-label{position:absolute;bottom:-18px;left:50%;transform:translateX(-50%);font-family:'Bebas Neue',sans-serif;font-size:0.7rem;color:var(--cream);opacity:0.4;letter-spacing:1px}
.conga-row.on-fire .tap-conga{box-shadow:0 0 20px rgba(255,107,53,0.4),0 4px 12px rgba(0,0,0,0.4)}
.conga-row.on-fire .tap-conga.lit{box-shadow:0 0 40px var(--gold),0 0 60px var(--orange),0 8px 20px rgba(255,107,53,0.6)}
.conga-row.fuego-mode .tap-conga{animation:flamePulse 0.3s ease-in-out infinite alternate;box-shadow:0 0 30px rgba(255,107,53,0.6),0 0 50px rgba(255,69,0,0.4),0 4px 12px rgba(0,0,0,0.4)}
.conga-row.fuego-mode .tap-conga::before{background:linear-gradient(180deg,#FFE4A0 0%,#FFD700 50%,#FF8C42 100%)!important}
.conga-row.fuego-mode .tap-conga.lit{box-shadow:0 0 50px var(--gold),0 0 80px var(--orange),0 0 100px rgba(255,69,0,0.5),0 8px 20px rgba(255,107,53,0.6);animation:fuegoBurst 0.15s ease-out}
@keyframes flamePulse{0%{transform:scale(1);filter:brightness(1)}100%{transform:scale(1.03);filter:brightness(1.1)}}
@keyframes fuegoBurst{0%{transform:scale(1.2) translateY(-5px)}50%{transform:scale(1.35) translateY(-8px)}100%{transform:scale(1.2) translateY(-5px)}}
.info-strip{display:flex;justify-content:center;gap:12px;margin:4px 0 2px;flex-shrink:0}
.info-box{text-align:center;padding:6px 14px;background:rgba(255,255,255,0.05);border-radius:10px;border:1px solid rgba(255,215,0,0.15);min-width:70px}
.info-label{font-size:0.5rem;letter-spacing:2px;color:var(--cream);opacity:0.5;text-transform:uppercase;margin-bottom:1px}
.info-value{font-family:'Bebas Neue',sans-serif;font-size:1.3rem;color:var(--gold)}
.feedback{height:22px;display:flex;align-items:center;justify-content:center;flex-shrink:0}
.feedback-text{font-family:'Bebas Neue',sans-serif;font-size:1.3rem;letter-spacing:3px;opacity:0;transition:opacity 0.1s}
.feedback-text.show{opacity:1}
.feedback-text.perfect{color:var(--gold);text-shadow:0 0 20px var(--gold)}
.feedback-text.good{color:var(--teal)}
.feedback-text.early{color:var(--orange)}
.feedback-text.late{color:var(--hot-pink)}
.feedback-text.miss{color:#ff4444}
.feedback-text.wrong{color:#ff4444}
.feedback-text.start{color:var(--cream);opacity:0.7;font-size:0.9rem}
.setup-screen{display:flex;flex-direction:column;align-items:center;gap:8px;flex:1;justify-content:center;overflow:hidden}
.setup-section{width:100%;flex-shrink:0}
.setup-label{font-family:'Bebas Neue',sans-serif;font-size:10px;letter-spacing:3px;color:rgba(255,255,255,.35);text-align:center;margin-bottom:4px}

.start-btn-big{width:100%;padding:14px;font-size:1.2rem;margin-top:4px}
.play-screen{display:flex;flex-direction:column;align-items:center;flex:1;overflow:hidden}
.play-screen.hidden{display:none}
.play-header{display:flex;align-items:center;justify-content:space-between;width:100%;padding:2px 0;flex-shrink:0}
.play-back-btn{background:none;border:2px solid rgba(255,255,255,.15);border-radius:50%;width:36px;height:36px;color:var(--cream);font-size:16px;cursor:pointer;display:flex;align-items:center;justify-content:center;transition:all .2s}
.play-back-btn:active{background:rgba(255,255,255,.1)}
.play-mode-name{font-family:'Bebas Neue',sans-serif;font-size:1.1rem;letter-spacing:3px;color:var(--teal)}
.play-bpm{font-family:'Bebas Neue',sans-serif;font-size:0.9rem;letter-spacing:2px;color:rgba(255,255,255,.4)}
.stop-btn{width:100%;padding:10px;border:none;border-radius:12px;background:rgba(239,68,68,.15);border:2px solid rgba(239,68,68,.3);color:#EF4444;font-family:'Bebas Neue',sans-serif;font-size:0.9rem;letter-spacing:3px;cursor:pointer;flex-shrink:0;transition:all .2s}
.stop-btn:active{background:rgba(239,68,68,.25);transform:scale(.98)}
.mode-card{display:flex;align-items:center;gap:10px;padding:10px 14px;border-radius:14px;border:2px solid transparent;cursor:pointer;transition:all .25s;position:relative;overflow:hidden;padding-right:44px}
.mode-card:active{transform:scale(.97)}
.mode-card-icon{font-size:28px;flex-shrink:0;width:44px;height:44px;display:flex;align-items:center;justify-content:center;border-radius:12px}
.mode-card-info{flex:1;min-width:0}
.mode-card-name{font-family:'Bebas Neue',sans-serif;font-size:1.1rem;letter-spacing:2px;line-height:1}
.mode-card-desc{font-size:11px;font-weight:600;opacity:.5;margin-top:2px;letter-spacing:.2px}
.mode-card[data-mode="repitelo"]{background:rgba(155,89,182,.06);border-color:rgba(155,89,182,.15)}
.mode-card[data-mode="repitelo"] .mode-card-icon{background:rgba(155,89,182,.1)}
.mode-card[data-mode="repitelo"] .mode-card-name{color:#BB86FC}
.mode-card[data-mode="repitelo"].active{background:rgba(155,89,182,.12);border-color:rgba(155,89,182,.4);box-shadow:0 4px 20px rgba(155,89,182,.15)}
.mode-help-btn{position:absolute;right:10px;top:50%;transform:translateY(-50%);width:32px;height:32px;border-radius:50%;border:1.5px solid rgba(255,255,255,.15);background:rgba(255,255,255,.05);color:rgba(255,255,255,.35);font-family:'Bebas Neue',sans-serif;font-size:14px;font-weight:700;cursor:pointer;display:flex;align-items:center;justify-content:center;transition:all .2s;padding:0;line-height:1;z-index:10;-webkit-tap-highlight-color:transparent}
.mode-help-btn:active{background:rgba(255,255,255,.15);color:rgba(255,255,255,.6);transform:translateY(-50%) scale(.9)}
.help-overlay{position:fixed;top:0;left:0;width:100%;height:100%;background:rgba(0,0,0,.88);display:none;justify-content:center;align-items:center;z-index:350;backdrop-filter:blur(10px);-webkit-backdrop-filter:blur(10px)}
.help-overlay.show{display:flex}
.help-card{background:linear-gradient(160deg,#1a0a2e 0%,#2d1052 50%,#1a0a2e 100%);border:2px solid rgba(255,215,0,.2);border-radius:24px;padding:28px 24px;text-align:center;max-width:340px;width:calc(100% - 40px);position:relative;animation:upsellPop .4s cubic-bezier(.4,0,.2,1)}
.help-close{position:absolute;top:10px;right:14px;background:none;border:none;color:rgba(255,255,255,.3);font-size:18px;cursor:pointer;padding:8px 12px;z-index:10}
.help-icon{font-size:48px;margin-bottom:8px}
.help-title{font-family:'Bebas Neue',sans-serif;font-size:1.8rem;letter-spacing:4px;color:var(--gold);margin-bottom:2px}
.help-subtitle{font-size:11px;font-weight:700;letter-spacing:2px;text-transform:uppercase;color:rgba(255,255,255,.3);margin-bottom:16px}
.help-steps{text-align:left;margin-bottom:16px}
.help-step{display:flex;align-items:flex-start;gap:10px;margin-bottom:10px}
.help-step-num{width:24px;height:24px;border-radius:50%;background:rgba(255,215,0,.12);border:1.5px solid rgba(255,215,0,.25);color:var(--gold);font-family:'Bebas Neue',sans-serif;font-size:13px;display:flex;align-items:center;justify-content:center;flex-shrink:0}
.help-step-text{font-size:13px;color:rgba(255,255,255,.65);line-height:1.4;font-weight:500}
.help-tip{background:rgba(255,215,0,.06);border:1px solid rgba(255,215,0,.12);border-radius:12px;padding:10px 14px;font-size:12px;color:rgba(255,215,0,.6);font-weight:600;margin-bottom:16px;text-align:left}
.help-got-it{width:100%;padding:14px;border:none;border-radius:100px;background:linear-gradient(135deg,#FFD700,#FF8C42);color:#1A0A2E;font-family:'Bebas Neue',sans-serif;font-size:1.1rem;font-weight:700;letter-spacing:2px;cursor:pointer;box-shadow:0 6px 24px rgba(255,215,0,.3);transition:all .25s;z-index:10;position:relative}
.help-got-it:active{transform:scale(.96)}
.pattern-selector{display:flex;gap:4px;justify-content:center;flex-wrap:wrap}
.pattern-option{padding:5px 9px;border:1.5px solid rgba(255,20,147,0.25);border-radius:12px;background:transparent;color:var(--cream);font-family:'Bebas Neue',sans-serif;font-size:0.6rem;letter-spacing:1px;cursor:pointer;transition:all 0.2s}
.pattern-option:active{transform:scale(0.95)}
.pattern-option.active{border-color:var(--hot-pink);background:rgba(255,20,147,0.15);color:var(--hot-pink)}
.bpm-selector{display:flex;gap:8px;justify-content:center}
.bpm-option{padding:8px 16px;border:2px solid rgba(255,215,0,0.25);border-radius:10px;background:transparent;color:var(--cream);font-family:'Bebas Neue',sans-serif;font-size:0.85rem;letter-spacing:2px;cursor:pointer;transition:all 0.2s}
.bpm-option:active{transform:scale(0.95)}
.bpm-option.active{border-color:var(--gold);background:rgba(255,215,0,0.12);color:var(--gold)}
.start-btn{width:100%;padding:16px;border:none;border-radius:50px;font-family:'Bebas Neue',sans-serif;font-size:1.3rem;letter-spacing:3px;cursor:pointer;background:linear-gradient(135deg,var(--gold),var(--orange));color:#1a0f0f;box-shadow:0 6px 24px rgba(255,215,0,0.35);transition:all 0.3s}
.start-btn:active{transform:scale(0.98)}
.start-btn:disabled{opacity:0.5;cursor:not-allowed}
.challenge-complete{position:fixed;top:0;left:0;width:100%;height:100%;background:rgba(0,0,0,0.92);display:none;justify-content:center;align-items:center;z-index:300;flex-direction:column;gap:16px}
.challenge-complete.show{display:flex}
.challenge-result{font-family:'Bebas Neue',sans-serif;font-size:2.5rem;text-align:center;letter-spacing:3px}
.challenge-result.win{color:var(--gold);text-shadow:0 0 30px var(--gold)}
.challenge-result.lose{color:#FF6B35;text-shadow:0 0 20px #FF6B35}
.challenge-stats{font-family:'Bebas Neue',sans-serif;font-size:1.1rem;color:var(--cream);text-align:center;letter-spacing:2px}
.challenge-retry-btn{padding:14px 36px;border:none;border-radius:30px;font-family:'Bebas Neue',sans-serif;font-size:1.1rem;letter-spacing:2px;cursor:pointer;background:linear-gradient(135deg,var(--gold),var(--orange));color:#1a0f0f;box-shadow:0 4px 16px rgba(255,215,0,0.35);transition:all 0.3s}
.challenge-retry-btn:active{transform:scale(0.95)}
.repitelo-indicator{position:fixed;bottom:60px;left:50%;transform:translateX(-50%);border-radius:20px;padding:5px 14px;font-family:'Bebas Neue',sans-serif;font-size:0.8rem;color:white;letter-spacing:2px;display:none;z-index:100;transition:all .3s}
.repitelo-indicator.listening{background:rgba(46,125,82,0.9);display:block}
.repitelo-indicator.watching{background:rgba(155,89,182,0.9);display:block;animation:pulse 1s ease-in-out infinite}
.repitelo-progress{position:fixed;bottom:95px;left:50%;transform:translateX(-50%);display:none;gap:5px;z-index:100;align-items:center}
.repitelo-progress.show{display:flex}
.rep-dot{width:10px;height:10px;border-radius:50%;background:rgba(255,255,255,.2);border:2px solid rgba(255,255,255,.3);transition:all .3s}
.rep-dot.played{background:rgba(155,89,182,.7);border-color:rgba(155,89,182,.9)}
.rep-dot.correct{background:rgba(46,125,82,.8);border-color:rgba(46,125,82,1)}
.rep-dot.wrong{background:rgba(239,68,68,.8);border-color:rgba(239,68,68,1)}
.rep-dot.current{transform:scale(1.3);box-shadow:0 0 12px rgba(255,215,0,.5)}
.countdown-overlay{position:fixed;top:0;left:0;width:100%;height:100%;background:rgba(0,0,0,0.85);display:none;justify-content:center;align-items:center;z-index:250}
.countdown-overlay.show{display:flex}
.countdown-number{font-family:'Bebas Neue',sans-serif;font-size:7rem;color:var(--gold);text-shadow:0 0 40px var(--gold),0 0 80px var(--orange);animation:countdownPop 0.8s ease-out}
@keyframes countdownPop{0%{transform:scale(2);opacity:0}50%{transform:scale(1.2);opacity:1}100%{transform:scale(1);opacity:1}}
@keyframes upsellPop{from{transform:scale(.85);opacity:0}to{transform:scale(1);opacity:1}}
.color-burst{position:absolute;top:50%;left:50%;transform:translate(-50%,-50%);width:20px;height:20px;border-radius:50%;border:3px solid var(--burst-color,#FFD700);opacity:1;animation:burstRing 0.5s ease-out forwards;pointer-events:none}
@keyframes burstRing{0%{width:20px;height:20px;opacity:1}100%{width:120px;height:120px;opacity:0}}
.spark{position:absolute;width:5px;height:5px;border-radius:50%;pointer-events:none;animation:sparkFly 0.5s ease-out forwards}
@keyframes sparkFly{0%{opacity:1;transform:translate(0,0) scale(1)}100%{opacity:0;transform:translate(var(--tx),var(--ty)) scale(0)}}
.glow-trail{position:absolute;top:50%;left:50%;transform:translate(-50%,-50%);width:100%;height:100%;border-radius:40% 40% 35% 35% / 25% 25% 40% 40%;pointer-events:none;animation:glowTrail 0.7s ease-out forwards;z-index:-1}
@keyframes glowTrail{0%{box-shadow:0 0 30px var(--conga-glow),0 0 50px var(--conga-glow);opacity:1;transform:translate(-50%,-50%) scale(1)}100%{box-shadow:0 0 60px var(--conga-glow),0 0 100px var(--conga-glow);opacity:0;transform:translate(-50%,-50%) scale(1.4)}}
.tap-conga.neon-active{animation:neonPulse 0.4s ease-in-out}
@keyframes neonPulse{0%,100%{filter:brightness(1) drop-shadow(0 0 5px var(--conga-glow))}50%{filter:brightness(1.3) drop-shadow(0 0 15px var(--conga-glow))}}
.callout{position:absolute;top:50%;left:50%;transform:translate(-50%,-50%);font-family:'Bebas Neue',sans-serif;font-size:1.5rem;letter-spacing:2px;color:var(--gold);text-shadow:0 0 15px var(--gold),0 0 30px var(--orange);pointer-events:none;animation:calloutPop 0.7s ease-out forwards;z-index:100;white-space:nowrap}
@keyframes calloutPop{0%{opacity:0;transform:translate(-50%,-50%) scale(0.5)}20%{opacity:1;transform:translate(-50%,-50%) scale(1.2)}40%{transform:translate(-50%,-50%) scale(1)}100%{opacity:0;transform:translate(-50%,-75%) scale(1)}}
.flame{position:absolute;width:8px;height:12px;background:linear-gradient(to top,#ff6600,#ffcc00,transparent);border-radius:50% 50% 50% 50% / 60% 60% 40% 40%;opacity:0.8;animation:flameRise 0.6s ease-out infinite;pointer-events:none}
@keyframes flameRise{0%{transform:translateY(0) scale(1);opacity:0.8}100%{transform:translateY(-30px) scale(0.3);opacity:0}}
.tap-particle{position:absolute;width:7px;height:7px;border-radius:50%;pointer-events:none;z-index:50}
@keyframes particleBurst{0%{transform:translate(-50%,-50%) scale(1);opacity:1}100%{transform:translate(var(--tx),var(--ty)) scale(0);opacity:0}}
.confetti-container{position:fixed;top:0;left:0;width:100%;height:100%;pointer-events:none;z-index:200;overflow:hidden}
@keyframes confettiFall{0%{transform:translateY(-100px) rotate(0deg) scale(1);opacity:1}100%{transform:translateY(100vh) rotate(720deg) scale(0.5);opacity:0}}
.milestone{position:fixed;top:50%;left:50%;transform:translate(-50%,-50%) scale(0);font-family:'Bebas Neue',sans-serif;font-size:2.2rem;letter-spacing:3px;color:var(--gold);text-shadow:0 0 25px var(--gold),0 0 50px var(--orange);z-index:150;pointer-events:none;white-space:nowrap}
.milestone.show{animation:milestonePopup 1s ease-out forwards}
@keyframes milestonePopup{0%{transform:translate(-50%,-50%) scale(0);opacity:0}20%{transform:translate(-50%,-50%) scale(1.3);opacity:1}40%{transform:translate(-50%,-50%) scale(1);opacity:1}100%{transform:translate(-50%,-50%) scale(1.4);opacity:0}}
.game-area.beat-pulse{animation:beatPulse 0.1s ease-out}
@keyframes beatPulse{0%{transform:scale(1)}50%{transform:scale(1.02)}100%{transform:scale(1)}}
@keyframes shake{0%,100%{transform:translateX(0)}20%{transform:translateX(-6px)}40%{transform:translateX(6px)}60%{transform:translateX(-4px)}80%{transform:translateX(4px)}}
.shake{animation:shake 0.35s ease-out}
.stats-panel{position:fixed;top:0;left:0;width:100%;height:100%;background:rgba(0,0,0,0.98);z-index:10000;display:none;flex-direction:column;padding:20px;overflow-y:auto}
.stats-panel.show{display:flex}
.panel-header{display:flex;justify-content:space-between;align-items:center;margin-bottom:20px}
.panel-title{font-family:'Bebas Neue',sans-serif;font-size:1.6rem;color:var(--gold);letter-spacing:3px}
.panel-close{width:44px;height:44px;border-radius:50%;border:2px solid var(--gold);background:rgba(45,27,78,0.9);color:var(--gold);font-size:1.4rem;cursor:pointer;display:flex;align-items:center;justify-content:center;text-decoration:none}
.panel-close:active{background:rgba(255,215,0,0.2);transform:scale(0.9)}
.rank-section{background:rgba(255,255,255,0.05);border-radius:14px;padding:16px;margin-bottom:16px}
.rank-section-title{font-family:'Bebas Neue',sans-serif;font-size:0.9rem;color:var(--cream);opacity:0.7;letter-spacing:2px;margin-bottom:12px}
.current-rank{display:flex;align-items:center;gap:12px}
.rank-icon-large{font-size:2.5rem}
.rank-info{flex:1}
.rank-name{font-family:'Bebas Neue',sans-serif;font-size:1.3rem;color:var(--gold);letter-spacing:2px}
.rank-xp{font-size:0.8rem;color:var(--cream);opacity:0.7}
.rank-progress-bar{height:6px;background:rgba(255,255,255,0.1);border-radius:3px;overflow:hidden;margin-top:8px}
.rank-progress-fill{height:100%;background:linear-gradient(90deg,var(--gold),var(--orange));border-radius:3px;transition:width 0.5s}
.stats-grid{display:grid;grid-template-columns:repeat(2,1fr);gap:10px;margin-bottom:16px}
.stat-card{background:rgba(255,255,255,0.05);border-radius:10px;padding:12px;text-align:center}
.stat-value{font-family:'Bebas Neue',sans-serif;font-size:1.7rem;color:var(--gold)}
.stat-label{font-size:0.65rem;color:var(--cream);opacity:0.6;letter-spacing:1px;margin-top:3px}
.achievements-grid{display:grid;grid-template-columns:repeat(4,1fr);gap:8px}
.achievement{display:flex;flex-direction:column;align-items:center;padding:10px 6px;background:rgba(0,0,0,0.3);border-radius:8px;border:1px solid rgba(255,255,255,0.1)}
.achievement.unlocked{border-color:var(--gold);background:rgba(255,215,0,0.08)}
.achievement.locked{opacity:0.35;filter:grayscale(1)}
.achievement-icon{font-size:1.4rem;margin-bottom:3px}
.achievement-name{font-family:'Bebas Neue',sans-serif;font-size:0.55rem;color:var(--cream);letter-spacing:1px;text-align:center}
.achievement.unlocked .achievement-name{color:var(--gold)}
.achievement-popup{position:fixed;top:70px;left:50%;transform:translateX(-50%) translateY(-80px);background:linear-gradient(135deg,rgba(255,215,0,0.9),rgba(255,107,53,0.9));border-radius:14px;padding:12px 20px;display:flex;align-items:center;gap:10px;z-index:500;opacity:0;transition:all 0.5s ease-out;box-shadow:0 8px 30px rgba(255,215,0,0.4)}
.achievement-popup.show{transform:translateX(-50%) translateY(0);opacity:1}
.achievement-popup-icon{font-size:1.6rem}
.achievement-popup-text{font-family:'Bebas Neue',sans-serif;color:#1a0f0f}
.achievement-popup-title{font-size:0.6rem;opacity:0.8;letter-spacing:1px}
.achievement-popup-name{font-size:1rem;letter-spacing:2px}


@media(max-height:650px){
.bori-hero-img{width:90px}
.bori-hero-title{font-size:1.6rem}
.conga-row{width:250px;height:250px;gap:6px;padding:8px}
.conga-row.three-drums{width:240px;height:160px}
.conga-row.three-drums .tap-conga{width:65px;height:82px}
.tap-conga{width:65px;height:82px}
.info-box{padding:4px 10px}
.info-value{font-size:1.1rem}
.play-back-btn{width:30px;height:30px;font-size:14px}
}
@media(min-width:400px){.bori-hero-title{font-size:2.4rem}.bori-hero-img{width:140px}.conga-row{width:320px;height:320px}.tap-conga{width:80px;height:100px}.conga-row.three-drums{width:280px;height:210px}.conga-row.three-drums .tap-conga{width:80px;height:100px}}
</style>
</head>
<body>
<nav class="mini-nav"><div class="nav-row">
<a href="/" class="back-btn" id="navBackBtn">‚Üê Hey Bori</a>
<div class="nav-title">ü•Å CONGA</div>
<div class="nav-right"><button class="nav-icon-btn" id="statsBtn" onclick="updateStatsPanel();document.getElementById('statsPanel').classList.toggle('show')">üìä</button></div>
</div></nav>

<div class="confetti-container" id="confettiContainer"></div>
<div class="milestone" id="milestone"></div>
<div class="achievement-popup" id="achievementPopup"><div class="achievement-popup-icon" id="achievementPopupIcon">üèÖ</div><div class="achievement-popup-text"><div class="achievement-popup-title">¬°NUEVO LOGRO!</div><div class="achievement-popup-name" id="achievementPopupName"></div></div></div>

<div class="stats-panel" id="statsPanel">
<div class="panel-header"><div class="panel-title">üìä TU PROGRESO</div><a href="#" class="panel-close" onclick="this.closest('.stats-panel').classList.remove('show');return false;">‚úï</a></div>
<div class="rank-section"><div class="rank-section-title">üèÜ RANGO ACTUAL</div><div class="current-rank"><div class="rank-icon-large" id="rankIconLarge">ü•Å</div><div class="rank-info"><div class="rank-name" id="rankName">PRINCIPIANTE</div><div class="rank-xp" id="rankXp">0 / 100 XP</div><div class="rank-progress-bar"><div class="rank-progress-fill" id="rankProgressFill" style="width:0%"></div></div></div></div></div>
<div class="stats-grid"><div class="stat-card"><div class="stat-value" id="statBestStreak">0</div><div class="stat-label">BEST STREAK</div></div><div class="stat-card"><div class="stat-value" id="statTotalTaps">0</div><div class="stat-label">TOTAL TAPS</div></div><div class="stat-card"><div class="stat-value" id="statPerfects">0</div><div class="stat-label">PERFECTS</div></div><div class="stat-card"><div class="stat-value" id="statGamesPlayed">0</div><div class="stat-label">GAMES</div></div></div>
<div class="rank-section"><div class="rank-section-title">üèÖ LOGROS</div><div class="achievements-grid" id="achievementsGrid"></div></div>
</div>

<div class="container">
<div class="setup-screen" id="setupScreen">
<div class="bori-hero">
<img src="/conga.png" alt="Bori" class="bori-hero-img">
<div class="bori-hero-title">CONGA</div>
<div class="bori-hero-sub">SEQUENCIA</div>
</div>

<div class="setup-section">
<div class="mode-cards" id="modeCards">
<div class="mode-card active" data-mode="repitelo">
<div class="mode-card-icon">üß†</div>
<div class="mode-card-info"><div class="mode-card-name">REP√çTELO</div><div class="mode-card-desc">Escucha. Recuerda. Repite.</div></div>
<button class="mode-help-btn" data-help="repitelo">?</button>
</div>
</div>
</div>

<div class="setup-section"><div class="setup-label">TEMPO</div>
<div class="bpm-selector">
<button class="bpm-option" data-bpm="60">60</button>
<button class="bpm-option active" data-bpm="90">90</button>
<button class="bpm-option" data-bpm="120">120</button>
</div></div>

<div class="setup-section"><div class="setup-label">TAMBORES</div>
<div class="drum-toggle">
<button class="drum-toggle-btn active" data-drums="3" onclick="setDrumCount(3)">3 ü•Å</button>
<button class="drum-toggle-btn" data-drums="5" onclick="setDrumCount(5)">5 ü•Å</button>
</div></div>

<button class="start-btn start-btn-big" id="startBtn">üß† ¬°DALE!</button>


</div>

<div class="play-screen hidden" id="playScreen">
<div class="play-header">
<button class="play-back-btn" id="playBackBtn">‚úï</button>
<div class="play-mode-name" id="playModeName">REP√çTELO</div>
<div class="play-bpm" id="playBpmLabel">90 BPM</div>
</div>
<div class="game-area">
<div class="conga-row three-drums" id="congaRow">
<button class="tap-conga" id="conga0" data-index="0"><span class="conga-label">1</span></button>
<button class="tap-conga" id="conga1" data-index="1"><span class="conga-label">2</span></button>
<button class="tap-conga" id="conga2" data-index="2"><span class="conga-label">3</span></button>
<button class="tap-conga" id="conga3" data-index="3"><span class="conga-label">4</span></button>
<button class="tap-conga" id="conga4" data-index="4"><span class="conga-label">5</span></button>
</div>
<div class="info-strip">
<div class="info-box"><div class="info-label">Tempo</div><div class="info-value"><span id="currentBpm">90</span></div></div>
<div class="info-box"><div class="info-label">Ronda</div><div class="info-value" id="streak">0</div></div>
<div class="info-box"><div class="info-label">R√©cord</div><div class="info-value" id="best">0</div></div>
</div>
<div class="feedback"><div class="feedback-text" id="feedback"></div></div>
</div>
<button class="stop-btn" id="stopBtn">‚èπ PARAR</button>
</div>

<div class="challenge-complete" id="challengeComplete">
<div class="challenge-result" id="challengeResult">¬°GANASTE!</div>
<div class="challenge-stats" id="challengeStats"></div>
<button class="challenge-retry-btn" id="retryBtn">¬°OTRA VEZ!</button>
</div>
<div class="repitelo-indicator" id="repiteloIndicator">üß† ESCUCHA...</div>
<div class="repitelo-progress" id="repiteloProgress"></div>
<div class="help-overlay" id="helpOverlay">
<div class="help-card">
<button class="help-close" id="helpCloseBtn">‚úï</button>
<div class="help-icon" id="helpIcon">üß†</div>
<div class="help-title" id="helpTitle">REP√çTELO</div>
<div class="help-subtitle" id="helpSubtitle">C√≥mo Jugar</div>
<div class="help-steps" id="helpSteps"></div>
<div class="help-tip" id="helpTip"></div>
<button class="help-got-it" id="helpGotIt">¬°ENTENDIDO!</button>
</div>
</div>
<div class="countdown-overlay" id="countdownOverlay"><div class="countdown-number" id="countdownNumber">3</div></div>




</div>

<script>
(function(){
var startBtn=document.getElementById('startBtn'),feedback=document.getElementById('feedback'),streakEl=document.getElementById('streak'),bestEl=document.getElementById('best'),currentBpmEl=document.getElementById('currentBpm'),congaRow=document.getElementById('congaRow'),confettiContainer=document.getElementById('confettiContainer'),milestone=document.getElementById('milestone'),gameArea=document.querySelector('.game-area');
var tapCongas=[document.getElementById('conga0'),document.getElementById('conga1'),document.getElementById('conga2'),document.getElementById('conga3'),document.getElementById('conga4')];
var drumCount=3;

window.setDrumCount=function(n){
drumCount=n;
document.querySelectorAll('.drum-toggle-btn').forEach(function(b){b.classList.toggle('active',parseInt(b.dataset.drums)===n)});
if(n===3){congaRow.classList.add('three-drums')}else{congaRow.classList.remove('three-drums')}
};

var bpm=90;var isPlaying=false;var streak=0;
var best=parseInt(localStorage.getItem('conga-best'))||0;var feedbackTimeout=null;var audioCtx=null;
var currentMode='repitelo';
bestEl.textContent=best;

var bpmOptions=document.querySelectorAll('.bpm-option');
bpmOptions.forEach(function(btn){btn.onclick=function(){if(isPlaying)return;bpmOptions.forEach(function(b){b.classList.remove('active')});btn.classList.add('active');bpm=parseInt(btn.dataset.bpm);currentBpmEl.textContent=bpm}});

var challengeComplete=document.getElementById('challengeComplete'),challengeResult=document.getElementById('challengeResult'),challengeStats=document.getElementById('challengeStats'),retryBtn=document.getElementById('retryBtn'),countdownOverlay=document.getElementById('countdownOverlay'),countdownNumber=document.getElementById('countdownNumber'),repiteloIndicator=document.getElementById('repiteloIndicator'),repiteloProgress=document.getElementById('repiteloProgress');

document.querySelectorAll('.mode-help-btn').forEach(function(hb){
hb.addEventListener('touchstart',function(e){e.preventDefault();e.stopPropagation();showHelp(hb.dataset.help)},{passive:false});
hb.addEventListener('click',function(e){e.preventDefault();e.stopPropagation();showHelp(hb.dataset.help)});
});

function showCountdown(cb){var count=3;countdownOverlay.classList.add('show');countdownNumber.textContent=count;var ci=setInterval(function(){count--;if(count>0){countdownNumber.textContent=count;countdownNumber.style.animation='none';void countdownNumber.offsetWidth;countdownNumber.style.animation='countdownPop 0.8s ease-out';playCongaHit(2,'good')}else if(count===0){countdownNumber.textContent='¬°DALE!';countdownNumber.style.animation='none';void countdownNumber.offsetWidth;countdownNumber.style.animation='countdownPop 0.8s ease-out';playCongaRoll()}else{clearInterval(ci);countdownOverlay.classList.remove('show');if(cb)cb()}},1000)}

retryBtn.onclick=function(){challengeComplete.classList.remove('show');showCountdown(function(){repStart()})};

function initAudio(){if(!audioCtx)audioCtx=new(window.AudioContext||window.webkitAudioContext)();if(audioCtx.state==='suspended')audioCtx.resume()}

var noiseBuffer=null;
function createNoiseBuffer(){if(noiseBuffer||!audioCtx)return;var bs=audioCtx.sampleRate*0.1;noiseBuffer=audioCtx.createBuffer(1,bs,audioCtx.sampleRate);var o=noiseBuffer.getChannelData(0);for(var i=0;i<bs;i++)o[i]=Math.random()*2-1}

var congaPitches=[{freq:120,freqDecay:80},{freq:160,freqDecay:100},{freq:200,freqDecay:130},{freq:260,freqDecay:170},{freq:340,freqDecay:220}];

function playCongaHit(ci,q){if(!audioCtx)return;createNoiseBuffer();var n=audioCtx.currentTime;var p=congaPitches[ci]||congaPitches[2];var v=q==='perfect'?0.6:q==='good'?0.5:0.35;var d=q==='perfect'?0.35:q==='good'?0.28:0.15;
var o=audioCtx.createOscillator();var g=audioCtx.createGain();o.type='sine';o.frequency.setValueAtTime(p.freq,n);o.frequency.exponentialRampToValueAtTime(p.freqDecay,n+d);g.gain.setValueAtTime(0,n);g.gain.linearRampToValueAtTime(v,n+0.005);g.gain.exponentialRampToValueAtTime(0.001,n+d);o.connect(g);g.connect(audioCtx.destination);o.start(n);o.stop(n+d+0.05);
var o2=audioCtx.createOscillator();var g2=audioCtx.createGain();o2.type='sine';o2.frequency.setValueAtTime(p.freq*2.2,n);o2.frequency.exponentialRampToValueAtTime(p.freqDecay*1.5,n+d*0.5);g2.gain.setValueAtTime(0,n);g2.gain.linearRampToValueAtTime(v*0.25,n+0.003);g2.gain.exponentialRampToValueAtTime(0.001,n+d*0.5);o2.connect(g2);g2.connect(audioCtx.destination);o2.start(n);o2.stop(n+d);
if(noiseBuffer){var ns=audioCtx.createBufferSource();var ng=audioCtx.createGain();var nf=audioCtx.createBiquadFilter();ns.buffer=noiseBuffer;nf.type='bandpass';nf.frequency.value=p.freq*3;nf.Q.value=1.5;ng.gain.setValueAtTime(0.2,n);ng.gain.exponentialRampToValueAtTime(0.001,n+0.04);ns.connect(nf);nf.connect(ng);ng.connect(audioCtx.destination);ns.start(n);ns.stop(n+0.05)}}

function playWrongSound(){if(!audioCtx)return;var n=audioCtx.currentTime;var o=audioCtx.createOscillator();var g=audioCtx.createGain();o.type='sine';o.frequency.setValueAtTime(80,n);o.frequency.exponentialRampToValueAtTime(40,n+0.08);g.gain.setValueAtTime(0.25,n);g.gain.exponentialRampToValueAtTime(0.001,n+0.1);o.connect(g);g.connect(audioCtx.destination);o.start(n);o.stop(n+0.12)}

function playCoqui(){if(!audioCtx)return;var n=audioCtx.currentTime;var o1=audioCtx.createOscillator();var g1=audioCtx.createGain();o1.type='sine';o1.frequency.setValueAtTime(1200,n);o1.frequency.exponentialRampToValueAtTime(900,n+0.08);g1.gain.setValueAtTime(0,n);g1.gain.linearRampToValueAtTime(0.18,n+0.01);g1.gain.exponentialRampToValueAtTime(0.001,n+0.1);o1.connect(g1);g1.connect(audioCtx.destination);o1.start(n);o1.stop(n+0.12);var o2=audioCtx.createOscillator();var g2=audioCtx.createGain();o2.type='sine';o2.frequency.setValueAtTime(1800,n+0.12);o2.frequency.exponentialRampToValueAtTime(1400,n+0.22);g2.gain.setValueAtTime(0,n+0.12);g2.gain.linearRampToValueAtTime(0.22,n+0.13);g2.gain.exponentialRampToValueAtTime(0.001,n+0.25);o2.connect(g2);g2.connect(audioCtx.destination);o2.start(n+0.12);o2.stop(n+0.28)}

function playCongaRoll(){if(!audioCtx)return;var n=audioCtx.currentTime;[0,2,1,2,0,2,1,1,1].forEach(function(ci,i){var p=congaPitches[ci];var t=n+(i*0.06);var o=audioCtx.createOscillator();var g=audioCtx.createGain();o.type='sine';o.frequency.setValueAtTime(p.freq,t);o.frequency.exponentialRampToValueAtTime(p.freqDecay,t+0.12);g.gain.setValueAtTime(0,t);g.gain.linearRampToValueAtTime(0.3+i*0.04,t+0.005);g.gain.exponentialRampToValueAtTime(0.001,t+0.12);o.connect(g);g.connect(audioCtx.destination);o.start(t);o.stop(t+0.15)})}

var congaColors=['#FFD700','#FF6B35','#FF1493','#00D9D9','#9B59B6'];
var callouts=['¬°WEPA!','¬°FUEGO!','¬°DALE!','¬°AS√ç!','¬°OYE!','¬°DURO!','¬°AZ√öCAR!','¬°BORICUA!','¬°ESO!','üî•','üí•','‚ö°','üéØ','üí™','üáµüá∑','ü•Å'];
var calloutCounter=0;

function createColorBurst(el,ci){var b=document.createElement('div');b.className='color-burst';b.style.setProperty('--burst-color',congaColors[ci]);el.appendChild(b);setTimeout(function(){b.remove()},500)}
function createSparks(el,ci){var c=congaColors[ci];for(var i=0;i<6;i++){var s=document.createElement('div');s.className='spark';s.style.background=c;s.style.boxShadow='0 0 5px '+c;s.style.left='50%';s.style.top='30%';var a=(i/6)*Math.PI*2;var d=40+Math.random()*30;s.style.setProperty('--tx',Math.cos(a)*d+'px');s.style.setProperty('--ty',Math.sin(a)*d-15+'px');el.appendChild(s);setTimeout(function(x){x.remove()}.bind(null,s),500)}}
function createGlowTrail(el,ci){var t=document.createElement('div');t.className='glow-trail';t.style.setProperty('--conga-glow',congaColors[ci]);el.appendChild(t);setTimeout(function(){t.remove()},700);el.classList.add('neon-active');setTimeout(function(){el.classList.remove('neon-active')},400)}
function showCallout(el){calloutCounter++;if(calloutCounter%3!==0)return;var c=document.createElement('div');c.className='callout';c.textContent=callouts[Math.floor(Math.random()*callouts.length)];el.appendChild(c);setTimeout(function(){c.remove()},700)}
function createTapParticles(el){var r=el.getBoundingClientRect();var cx=r.left+r.width/2,cy=r.top+r.height/3;for(var i=0;i<5;i++){var p=document.createElement('div');p.className='tap-particle';p.style.left=cx+'px';p.style.top=cy+'px';p.style.background=congaColors[Math.floor(Math.random()*congaColors.length)];var a=(i/5)*Math.PI*2;var d=35+Math.random()*25;p.style.setProperty('--tx',Math.cos(a)*d+'px');p.style.setProperty('--ty',Math.sin(a)*d+'px');p.style.animation='particleBurst 0.3s ease-out forwards';document.body.appendChild(p);setTimeout(function(x){x.remove()}.bind(null,p),300)}}

function launchConfetti(){var colors=['#FFD700','#FF6B35','#FF1493','#00D9D9','#FF8C42','#32CD32'];for(var i=0;i<40;i++){var c=document.createElement('div');c.className='confetti';c.style.cssText='position:absolute;left:'+(20+Math.random()*60)+'%;top:-20px;background:'+colors[Math.floor(Math.random()*colors.length)]+';width:'+(5+Math.random()*7)+'px;height:'+(5+Math.random()*7)+'px;border-radius:'+(Math.random()>0.5?'50%':'2px')+';animation:confettiFall '+(1.5+Math.random()*1.5)+'s ease-out forwards;animation-delay:'+(Math.random()*0.3)+'s;opacity:0';confettiContainer.appendChild(c);setTimeout(function(x){x.remove()}.bind(null,c),3500)}}

var milestoneTimeout=null;
function showMilestone(t){clearTimeout(milestoneTimeout);milestone.textContent=t;milestone.classList.remove('show');void milestone.offsetWidth;milestone.classList.add('show');milestoneTimeout=setTimeout(function(){milestone.classList.remove('show')},1000)}
function vibrate(d){if(navigator.vibrate)navigator.vibrate(d)}

/* === PROGRESS SYSTEM === */
var ranks=[{name:'PRINCIPIANTE',icon:'ü•Å',xp:0},{name:'R√çTMICO',icon:'üéµ',xp:100},{name:'PERCUSIONISTA',icon:'üî•',xp:300},{name:'MAESTRO',icon:'‚≠ê',xp:600},{name:'LEYENDA',icon:'üëë',xp:1000}];
var achievements=[
{id:'first_tap',name:'PRIMER TAP',icon:'üëÜ',cond:function(s){return s.totalTaps>=1}},
{id:'games_5',name:'DEDICADO',icon:'üìö',cond:function(s){return s.gamesPlayed>=5}},
{id:'taps_100',name:'CALENTANDO',icon:'üå°Ô∏è',cond:function(s){return s.totalTaps>=100}},
{id:'taps_500',name:'MANOS üôå',icon:'üôå',cond:function(s){return s.totalTaps>=500}},
{id:'rep_3',name:'MEMORIA',icon:'üß†',cond:function(){return parseInt(localStorage.getItem('conga-rep-best')||'0')>=3}},
{id:'rep_5',name:'ELEFANTE',icon:'üêò',cond:function(){return parseInt(localStorage.getItem('conga-rep-best')||'0')>=5}},
{id:'rep_8',name:'GENIO',icon:'üß¨',cond:function(){return parseInt(localStorage.getItem('conga-rep-best')||'0')>=8}}
];
function getWeekStart(){var n=new Date();var d=n.getDay();var diff=n.getDate()-d+(d===0?-6:1);return new Date(n.setDate(diff)).toISOString().split('T')[0]}
function loadStats(){var def={xp:0,bestStreak:0,totalTaps:0,totalPerfects:0,gamesPlayed:0,survivalWins:0,unlockedAchievements:[],weeklyTaps:0,weeklyBest:0,weeklySessions:0,weekStart:getWeekStart()};var s=localStorage.getItem('conga-stats');if(s){var p=JSON.parse(s);if(p.weekStart!==getWeekStart()){p.weeklyTaps=0;p.weeklyBest=0;p.weeklySessions=0;p.weekStart=getWeekStart()}return Object.assign(def,p)}return def}
var ps=loadStats();
function saveStats(){localStorage.setItem('conga-stats',JSON.stringify(ps))}
function getRank(){for(var i=ranks.length-1;i>=0;i--){if(ps.xp>=ranks[i].xp)return ranks[i]}return ranks[0]}
function getNextRank(){var ci=ranks.findIndex(function(r){return r.name===getRank().name});return ci<ranks.length-1?ranks[ci+1]:null}
function addXP(a){var old=getRank();ps.xp+=a;var nw=getRank();if(nw.name!==old.name){showMilestone('üéâ '+nw.name+' '+nw.icon);playCongaRoll();launchConfetti()}saveStats()}
function trackGame(){ps.gamesPlayed++;ps.weeklySessions++;addXP(5);saveStats();try{var savedPin=localStorage.getItem('bori_pin');if(savedPin){fetch('/api/activity',{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify({userId:savedPin,event:'game',detail:{game:'Conga'}})}).catch(function(){});}}catch(e){}}
function checkAchievements(){achievements.forEach(function(a){if(ps.unlockedAchievements.indexOf(a.id)===-1&&a.cond(ps)){ps.unlockedAchievements.push(a.id);addXP(10);var pi=document.getElementById('achievementPopupIcon');var pn=document.getElementById('achievementPopupName');var pp=document.getElementById('achievementPopup');pi.textContent=a.icon;pn.textContent=a.name;pp.classList.add('show');playCoqui();setTimeout(function(){pp.classList.remove('show')},3000);saveStats()}})}

window.updateStatsPanel=function(){var r=getRank();var nr=getNextRank();document.getElementById('rankIconLarge').textContent=r.icon;document.getElementById('rankName').textContent=r.name;
if(nr){var prog=((ps.xp-r.xp)/(nr.xp-r.xp))*100;document.getElementById('rankXp').textContent=ps.xp+' / '+nr.xp+' XP';document.getElementById('rankProgressFill').style.width=Math.min(100,prog)+'%'}else{document.getElementById('rankXp').textContent=ps.xp+' XP (MAX!)';document.getElementById('rankProgressFill').style.width='100%'}
document.getElementById('statBestStreak').textContent=ps.bestStreak;document.getElementById('statTotalTaps').textContent=ps.totalTaps;document.getElementById('statPerfects').textContent=ps.totalPerfects;document.getElementById('statGamesPlayed').textContent=ps.gamesPlayed;
var ag=document.getElementById('achievementsGrid');ag.innerHTML='';achievements.forEach(function(a){var u=ps.unlockedAchievements.indexOf(a.id)!==-1;var d=document.createElement('div');d.className='achievement '+(u?'unlocked':'locked');d.innerHTML='<div class="achievement-icon">'+a.icon+'</div><div class="achievement-name">'+a.name+'</div>';ag.appendChild(d)})};
updateStatsPanel();

/* ‚ïê‚ïê‚ïê REP√çTELO ENGINE ‚ïê‚ïê‚ïê */
var repSequence=[];var repPlayerIndex=0;var repRound=0;
var repBestRound=parseInt(localStorage.getItem('conga-rep-best')||'0');
var repIsPlaying=false;var repIsListening=false;var repPlaybackTimeout=null;

function repStart(){repSequence=[];repRound=0;repPlayerIndex=0;repIsPlaying=false;repIsListening=false;isPlaying=true;trackGame();repNextRound()}

function repNextRound(){repRound++;repPlayerIndex=0;repIsListening=false;repIsPlaying=true;
var maxDrum=drumCount===3?3:5;repSequence.push(Math.floor(Math.random()*maxDrum));
repRenderDots();
streakEl.textContent=repRound;
repiteloIndicator.textContent='üß† RONDA '+repRound+' ¬∑ ESCUCHA...';repiteloIndicator.className='repitelo-indicator watching';
setTimeout(function(){repPlaySequence(0)},repRound===1?600:900)}

function repRenderDots(){repiteloProgress.innerHTML='';for(var i=0;i<repSequence.length;i++){var dot=document.createElement('div');dot.className='rep-dot';dot.id='repDot'+i;repiteloProgress.appendChild(dot)}repiteloProgress.classList.add('show')}

function repPlaySequence(idx){if(!isPlaying)return;if(idx>=repSequence.length){repIsPlaying=false;repIsListening=true;repPlayerIndex=0;repiteloIndicator.textContent='ü•Å ¬°AHORA T√ö! ('+repSequence.length+' toques)';repiteloIndicator.className='repitelo-indicator listening';var fd=document.getElementById('repDot0');if(fd)fd.classList.add('current');return}
var ci=repSequence[idx];var el=tapCongas[ci];tapCongas.forEach(function(c){c.classList.remove('lit')});el.classList.add('lit');playCongaHit(ci,'good');createTapParticles(el);vibrate(15);
var dot=document.getElementById('repDot'+idx);if(dot)dot.classList.add('played');
var speed=60000/bpm;setTimeout(function(){el.classList.remove('lit');setTimeout(function(){repPlaySequence(idx+1)},speed*0.2)},speed*0.6)}

function repHandleTap(ci){if(!repIsListening||repIsPlaying)return false;
var expected=repSequence[repPlayerIndex];var dot=document.getElementById('repDot'+repPlayerIndex);
if(ci===expected){if(dot){dot.classList.remove('current');dot.classList.add('correct')}repPlayerIndex++;
if(repPlayerIndex<repSequence.length){var nd=document.getElementById('repDot'+repPlayerIndex);if(nd)nd.classList.add('current')}
if(repPlayerIndex>=repSequence.length){repIsListening=false;repiteloIndicator.textContent='¬°WEPA! üî• Ronda '+repRound+' completada';repiteloIndicator.className='repitelo-indicator listening';playCongaRoll();if(repRound>=3)launchConfetti();if(repRound>repBestRound){repBestRound=repRound;localStorage.setItem('conga-rep-best',String(repBestRound));if(repRound>ps.bestStreak){ps.bestStreak=repRound;saveStats()}}setTimeout(function(){repNextRound()},1400)}
ps.totalTaps++;checkAchievements();saveStats();return true}
else{if(dot){dot.classList.remove('current');dot.classList.add('wrong')}repIsListening=false;playWrongSound();vibrate(80);
repiteloIndicator.textContent='¬°CASI! Era el tambor '+(expected+1);repiteloIndicator.className='repitelo-indicator watching';
tapCongas.forEach(function(c){c.classList.remove('lit')});tapCongas[expected].classList.add('lit');
setTimeout(function(){tapCongas[expected].classList.remove('lit');repEndGame()},1200);return true}}

function repEndGame(){repIsPlaying=false;repIsListening=false;var completed=repRound-1;
challengeResult.textContent=completed>=5?'¬°MEMORIA DE ORO! üß†':completed>=3?'¬°MUY BIEN! üî•':'¬°BUEN INTENTO! üí™';
challengeResult.className='challenge-result '+(completed>=3?'win':'lose');
challengeStats.textContent='Rondas: '+completed+' | R√©cord: '+repBestRound;
if(completed>=3){playCongaRoll();launchConfetti()}
challengeComplete.classList.add('show');isPlaying=false;
repiteloIndicator.className='repitelo-indicator';repiteloProgress.classList.remove('show');
tapCongas.forEach(function(c){c.classList.remove('lit')});

if(completed>0){addXP(completed*5);checkAchievements();saveStats()}}

function repCleanup(){repIsPlaying=false;repIsListening=false;repSequence=[];repRound=0;repPlayerIndex=0;clearTimeout(repPlaybackTimeout);repiteloIndicator.className='repitelo-indicator';repiteloProgress.classList.remove('show')}

function stopGame(){isPlaying=false;repCleanup();tapCongas.forEach(function(c){c.classList.remove('lit')})}

/* ‚ïê‚ïê‚ïê HELP ‚ïê‚ïê‚ïê */
var helpOverlay=document.getElementById('helpOverlay');
var helpData={repitelo:{icon:'üß†',title:'REP√çTELO',steps:['Bori toca una secuencia de tambores ‚Äî ¬°escucha y observa!','Cuando veas "¬°AHORA T√ö!" repite la secuencia exacta','Cada ronda a√±ade un toque m√°s a la secuencia','El juego termina cuando fallas ‚Äî ¬°intenta llegar m√°s lejos!'],tip:'üí° La secuencia se toca al BPM que seleccionaste. Empieza con 60 si es tu primera vez.'}};

function showHelp(mode){var d=helpData[mode];if(!d)return;document.getElementById('helpIcon').textContent=d.icon;document.getElementById('helpTitle').textContent=d.title;var stepsEl=document.getElementById('helpSteps');stepsEl.innerHTML='';d.steps.forEach(function(s,i){var step=document.createElement('div');step.className='help-step';step.innerHTML='<div class="help-step-num">'+(i+1)+'</div><div class="help-step-text">'+s+'</div>';stepsEl.appendChild(step)});document.getElementById('helpTip').textContent=d.tip;helpOverlay.classList.add('show')}
function closeHelp(){helpOverlay.classList.remove('show')}
['click','touchstart'].forEach(function(evt){document.getElementById('helpGotIt').addEventListener(evt,function(e){e.preventDefault();e.stopPropagation();closeHelp()},{passive:false});document.getElementById('helpCloseBtn').addEventListener(evt,function(e){e.preventDefault();e.stopPropagation();closeHelp()},{passive:false})});
helpOverlay.addEventListener('click',function(e){if(e.target===helpOverlay)closeHelp()});

/* ‚ïê‚ïê‚ïê SCREEN TRANSITIONS ‚ïê‚ïê‚ïê */
var setupScreen=document.getElementById('setupScreen');var playScreen=document.getElementById('playScreen');var stopBtn=document.getElementById('stopBtn');var playBackBtn=document.getElementById('playBackBtn');var playBpmLabel=document.getElementById('playBpmLabel');var navBackBtn=document.getElementById('navBackBtn');

function showPlayScreen(){setupScreen.style.display='none';playScreen.classList.remove('hidden');playBpmLabel.textContent=bpm+' BPM';navBackBtn.textContent='‚Üê Men√∫';navBackBtn.href='#';navBackBtn.onclick=function(e){e.preventDefault();if(isPlaying){repCleanup();stopGame()}showSetupScreen()};window.scrollTo(0,0)}
function showSetupScreen(){playScreen.classList.add('hidden');setupScreen.style.display='flex';navBackBtn.textContent='‚Üê Hey Bori';navBackBtn.href='/';navBackBtn.onclick=null}

startBtn.onclick=function(){initAudio();showPlayScreen();showCountdown(function(){repStart()})};
stopBtn.onclick=function(){repCleanup();stopGame();showSetupScreen()};
playBackBtn.onclick=function(){if(isPlaying){repCleanup();stopGame()}showSetupScreen()};

function handleTap(ci,el){initAudio();playCongaHit(ci,'good');createTapParticles(el);createGlowTrail(el,ci);vibrate(15);
el.classList.add('hit-correct');setTimeout(function(){el.classList.remove('hit-correct')},200);
if(isPlaying&&repIsListening){repHandleTap(ci);return}
if(!isPlaying){el.classList.add('tapped');createColorBurst(el,ci);createSparks(el,ci);showCallout(el);setTimeout(function(){el.classList.remove('tapped')},150);return}}

tapCongas.forEach(function(c,i){c.addEventListener('touchstart',function(e){e.preventDefault();handleTap(i,c)},{passive:false});c.addEventListener('mousedown',function(e){e.preventDefault();handleTap(i,c)});c.addEventListener('touchend',function(e){e.preventDefault()},{passive:false})});
})();
</script>
</body>
</html>