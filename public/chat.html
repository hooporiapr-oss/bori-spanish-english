<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
  <title>Hey Bori ‚Äî Real Conversations</title>
  <link rel="icon" type="image/png" href="/icon-01F.png">
  <link rel="apple-touch-icon" href="/icon-01F.png">
  <link href="https://fonts.googleapis.com/css2?family=Nunito:wght@400;600;700;800;900&display=swap" rel="stylesheet">
  <style>
*,*::before,*::after{box-sizing:border-box;margin:0;padding:0}
:root{--body:'Nunito',sans-serif;--bg:#FFFDF8;--white:#FFF;--dark:#1A1A1A;--text:#2A2A2A;--text-2:#5A5A5A;--text-3:#999;--border:#EDE8DF;--warm:#F8F4ED;--sun:#FF6B35;--sun-dark:#E55A25;--green:#22C55E;--green-dark:#16A34A}
html,body{height:100%;overflow:hidden}
body{font-family:var(--body);background:var(--bg);color:var(--text);-webkit-font-smoothing:antialiased}
.app{display:flex;flex-direction:column;height:100dvh;max-width:700px;margin:0 auto}

/* Header */
.hdr{display:flex;align-items:center;gap:10px;padding:12px 16px;background:var(--white);border-bottom:1px solid var(--border);flex-shrink:0;z-index:10}
.hdr-back{text-decoration:none;font-size:24px;color:var(--text-2);padding:2px 6px;border-radius:8px}
.hdr-av{width:52px;height:52px;flex-shrink:0;overflow:hidden}
.hdr-av img{width:100%;height:100%;object-fit:contain}
.hdr-info{flex:1}
.hdr-name{font-size:18px;font-weight:800;color:var(--dark)}.hdr-name .hey{color:var(--sun)}
.hdr-sub{font-size:12px;color:var(--text-3);font-weight:600}
.hdr-badge{font-size:10px;font-weight:800;padding:2px 8px;border-radius:20px;display:none}
.hdr-badge.trial{display:inline-block;background:rgba(34,197,94,0.15);color:var(--green-dark)}
.hdr-badge.active{display:inline-block;background:rgba(255,107,53,0.15);color:var(--sun-dark)}
.share-btn{width:38px;height:38px;border-radius:50%;background:var(--warm);border:1px solid var(--border);cursor:pointer;display:flex;align-items:center;justify-content:center;font-size:17px;transition:all .2s;flex-shrink:0}
.share-btn:hover{background:rgba(255,107,53,0.1);border-color:var(--sun)}
.burger{width:38px;height:38px;border-radius:50%;background:var(--warm);border:1px solid var(--border);cursor:pointer;display:flex;flex-direction:column;align-items:center;justify-content:center;gap:4px;-webkit-tap-highlight-color:transparent}
.burger:active{transform:scale(.95)}
.burger-line{width:16px;height:2.5px;background:var(--sun);border-radius:2px;transition:all .3s}
.burger.open .burger-line:nth-child(1){transform:rotate(45deg) translate(4px,4px)}
.burger.open .burger-line:nth-child(2){opacity:0}
.burger.open .burger-line:nth-child(3){transform:rotate(-45deg) translate(4px,-4px)}

/* Menu */
.menu-overlay{position:fixed;inset:0;background:rgba(0,0,0,0.4);z-index:100;opacity:0;pointer-events:none;transition:opacity .3s}
.menu-overlay.open{opacity:1;pointer-events:auto}
.menu{position:fixed;top:0;right:-280px;width:280px;height:100%;background:var(--white);z-index:101;transition:right .3s cubic-bezier(.22,1,.36,1);box-shadow:-4px 0 24px rgba(0,0,0,0.1);display:flex;flex-direction:column;padding:28px 0;overflow-y:auto}
.menu.open{right:0}
.menu-header{padding:0 24px 20px;border-bottom:1px solid var(--border);display:flex;align-items:center;gap:12px}
.menu-header img{width:40px;height:40px;object-fit:contain}
.menu-header-text{flex:1}
.menu-header-title{font-size:18px;font-weight:900;color:var(--dark)}.menu-header-title .hey{color:var(--sun)}
.menu-header-sub{font-size:11px;color:var(--text-3);font-weight:600}
.menu-section{padding:18px 24px 8px;font-size:10px;font-weight:800;color:var(--text-3);text-transform:uppercase;letter-spacing:1.5px}
.menu-link{display:flex;align-items:center;gap:14px;padding:14px 24px;text-decoration:none;color:var(--text);font-size:16px;font-weight:700;transition:background .15s;-webkit-tap-highlight-color:transparent}
.menu-link:active{background:var(--warm)}
.menu-link-icon{font-size:22px;width:30px;text-align:center}
.menu-link-arrow{color:var(--text-3);font-size:14px;margin-left:auto}
.menu-spacer{flex:1}
.menu-footer{padding:16px 24px;border-top:1px solid var(--border)}
.menu-footer a{font-size:12px;color:var(--text-3);text-decoration:none;font-weight:600;margin-right:14px}
.menu-footer a:active{color:var(--sun)}
.menu-footer p{font-size:10px;color:var(--text-3);margin-top:8px;opacity:.5}

/* Widget area */
.widget-area{flex:1;position:relative;overflow:hidden}

/* Full-bleed background image */
.bg-image{position:absolute;inset:0;z-index:0}
.bg-image img{width:100%;height:100%;object-fit:cover}

/* Chrome banner */
.chrome-banner{display:none;position:absolute;bottom:24px;left:16px;right:16px;z-index:5;background:rgba(255,255,255,0.95);backdrop-filter:blur(10px);border-radius:16px;padding:20px;text-align:center;box-shadow:0 4px 24px rgba(0,0,0,0.15)}
.chrome-banner-icon{font-size:32px;margin-bottom:8px}
.chrome-banner-title{font-size:16px;font-weight:800;color:var(--dark);margin-bottom:4px}
.chrome-banner-text{font-size:13px;font-weight:600;color:var(--text-2);line-height:1.5}
.chrome-banner-text span{color:var(--sun);font-weight:800}
.is-chrome .chrome-banner{display:block}
.is-chrome elevenlabs-convai{display:none !important}

/* Force the ElevenLabs widget to fill our container and sit above background */
elevenlabs-convai{
  position:absolute !important;
  inset:0 !important;
  width:100% !important;
  height:100% !important;
  z-index:1 !important;
}

/* ‚ïê‚ïê‚ïê GATE CARD ‚ïê‚ïê‚ïê */
.gate-overlay{position:absolute;inset:0;z-index:10;display:flex;align-items:center;justify-content:center;padding:20px}
.gate-overlay.hidden{display:none}
.gate-card{background:rgba(255,255,255,0.97);backdrop-filter:blur(16px);border-radius:24px;padding:32px 24px 28px;max-width:380px;width:100%;text-align:center;box-shadow:0 8px 40px rgba(0,0,0,0.18);animation:gateIn .4s ease}
@keyframes gateIn{from{opacity:0;transform:translateY(16px)}to{opacity:1;transform:translateY(0)}}

/* Language toggle */
.lang-toggle{display:flex;justify-content:center;margin-bottom:18px}
.lang-toggle-track{display:flex;background:var(--warm);border:1px solid var(--border);border-radius:10px;overflow:hidden}
.lang-toggle-opt{padding:7px 18px;font-size:13px;font-weight:800;color:var(--text-3);cursor:pointer;transition:all .2s;border:none;background:none;font-family:var(--body)}
.lang-toggle-opt.active{background:var(--sun);color:var(--white);border-radius:9px}

.gate-icon{font-size:48px;margin-bottom:10px}
.gate-title{font-size:20px;font-weight:900;color:var(--dark);margin-bottom:2px}
.gate-title .hey{color:var(--sun)}
.gate-subtitle{font-size:14px;font-weight:700;color:var(--text-2);margin-bottom:14px}
.gate-price{font-size:32px;font-weight:900;color:var(--sun);margin-bottom:2px}
.gate-price-sub{font-size:13px;font-weight:600;color:var(--text-3);margin-bottom:16px}
.gate-features{text-align:left;margin-bottom:18px;padding:0 8px}
.gate-feat{display:flex;align-items:center;gap:10px;font-size:14px;font-weight:700;color:var(--text);margin-bottom:10px}
.gate-feat-check{color:var(--green);font-size:18px;flex-shrink:0}
.gate-btn{width:100%;padding:16px;border:none;border-radius:14px;background:var(--sun);color:var(--white);font-family:var(--body);font-size:17px;font-weight:800;cursor:pointer;transition:all .2s}
.gate-btn:hover{background:var(--sun-dark)}
.gate-btn:active{transform:scale(.98)}
.gate-btn:disabled{opacity:.6;cursor:not-allowed}
.gate-trial-note{font-size:12px;font-weight:700;color:var(--green-dark);margin-top:10px}
.gate-divider{display:flex;align-items:center;gap:12px;margin:18px 0 14px}
.gate-divider-line{flex:1;height:1px;background:var(--border)}
.gate-divider-text{font-size:12px;font-weight:700;color:var(--text-3)}
.gate-input{width:100%;padding:13px 16px;border:2px solid var(--border);border-radius:14px;font-family:var(--body);font-size:15px;font-weight:700;color:var(--dark);background:var(--white);outline:none;transition:border-color .2s}
.gate-input:focus{border-color:var(--sun)}
.gate-input::placeholder{color:var(--text-3);font-weight:600}
.gate-login-btn{width:100%;margin-top:10px;padding:14px;border:2px solid var(--border);border-radius:14px;background:var(--white);color:var(--text);font-family:var(--body);font-size:15px;font-weight:800;cursor:pointer;transition:all .2s}
.gate-login-btn:hover{border-color:var(--sun);color:var(--sun)}
.gate-login-btn:active{transform:scale(.98)}
.gate-login-btn:disabled{opacity:.6;cursor:not-allowed}
.gate-error{font-size:12px;color:#EF4444;font-weight:700;margin-top:8px;display:none}
.gate-loading{display:none}
.gate-loading .spinner{width:28px;height:28px;border:3px solid var(--border);border-top-color:var(--sun);border-radius:50%;animation:spin .7s linear infinite;margin:0 auto}
@keyframes spin{to{transform:rotate(360deg)}}

/* ‚ïê‚ïê‚ïê TRIAL BANNER ‚ïê‚ïê‚ïê */
.trial-banner{display:none;position:absolute;top:12px;left:16px;right:16px;z-index:5;background:rgba(255,255,255,0.95);backdrop-filter:blur(10px);border-radius:12px;padding:10px 16px;text-align:center;box-shadow:0 2px 12px rgba(0,0,0,0.1);font-size:13px;font-weight:700;color:var(--text)}
.trial-banner .days{color:var(--sun);font-weight:900}
.trial-banner .manage-link{color:var(--sun);text-decoration:none;font-weight:800;margin-left:6px}

.toast{position:fixed;bottom:80px;left:50%;transform:translateX(-50%) translateY(20px);background:var(--dark);color:var(--white);padding:12px 28px;border-radius:50px;font-size:14px;font-weight:700;opacity:0;transition:all .3s;z-index:300;pointer-events:none}
.toast.show{opacity:1;transform:translateX(-50%) translateY(0)}
  </style>
</head>
<body>
  <div class="menu-overlay" id="menuOverlay" onclick="toggleMenu()"></div>
  <div class="menu" id="menu">
    <div class="menu-header"><img src="/icon.png" alt="Hey Bori"><div class="menu-header-text"><div class="menu-header-title"><span class="hey">Hey</span> Bori</div><div class="menu-header-sub">Real Conversations</div></div></div>
    <div class="menu-section">MAIN</div>
    <a href="/" class="menu-link"><span class="menu-link-icon">üè†</span>Home<span class="menu-link-arrow">‚Ä∫</span></a>
    <a href="/chat" class="menu-link"><span class="menu-link-icon">üéôÔ∏è</span>Bori Voice<span class="menu-link-arrow">‚Ä∫</span></a>
    <div class="menu-section">CULTURAL GAMES</div>
    <a href="/the-conga.html" class="menu-link"><span class="menu-link-icon">ü•Å</span>Conga<span class="menu-link-arrow">‚Ä∫</span></a>
    <a href="/the-lelolai.html" class="menu-link"><span class="menu-link-icon">üî§</span>LeLoLai Letras<span class="menu-link-arrow">‚Ä∫</span></a>
    <a href="/the-domino.html" class="menu-link"><span class="menu-link-icon">üé≤</span>La Marquesina<span class="menu-link-arrow">‚Ä∫</span></a>
    <a href="/the-isla.html" class="menu-link"><span class="menu-link-icon">üß©</span>La Isla<span class="menu-link-arrow">‚Ä∫</span></a>
    <div class="menu-section">ACCOUNT</div>
    <a href="#" class="menu-link" id="menuManage" onclick="openPortal();return false;" style="display:none"><span class="menu-link-icon">‚öôÔ∏è</span>Manage Subscription<span class="menu-link-arrow">‚Ä∫</span></a>
    <a href="#" class="menu-link" id="menuLogout" onclick="logoutUser();return false;" style="display:none"><span class="menu-link-icon">üëã</span>Log Out<span class="menu-link-arrow">‚Ä∫</span></a>
    <div class="menu-spacer"></div>
    <div class="menu-footer"><a href="/privacy.html">Privacy</a><a href="/terms.html">Terms</a><p>¬© 2026 GoStar Digital LLC üáµüá∑</p></div>
  </div>

  <div class="app">
    <div class="hdr">
      <a href="/" class="hdr-back">‚Üê</a>
      <div class="hdr-av"><img src="/icon.png" alt="Hey Bori"></div>
      <div class="hdr-info">
        <div class="hdr-name"><span class="hey">Hey</span> Bori <span class="hdr-badge" id="hdrBadge"></span></div>
        <div class="hdr-sub" id="hdrSub">Real Conversations</div>
      </div>
      <button class="share-btn" onclick="doShare()">üì§</button>
      <button class="burger" id="burger" onclick="toggleMenu()"><div class="burger-line"></div><div class="burger-line"></div><div class="burger-line"></div></button>
    </div>

    <div class="widget-area">
      <div class="bg-image"><img src="/boriosj.png" alt="Puerto Rico"></div>

      <div class="chrome-banner">
        <div class="chrome-banner-icon">üéôÔ∏è</div>
        <div class="chrome-banner-title">Voice works best in Safari</div>
        <div class="chrome-banner-text">Open <span>heybori.com</span> in Safari for the full voice experience with Bori. Just copy the link and paste it in Safari!</div>
      </div>

      <div class="trial-banner" id="trialBanner">
        üéôÔ∏è <span id="trialBannerText">Free trial:</span> <span class="days" id="trialDays">7</span> <span id="trialBannerDays">days left</span>
        <a href="#" class="manage-link" onclick="openPortal();return false;" id="trialManageLink">Manage</a>
      </div>

      <!-- ‚ïê‚ïê‚ïê GATE CARD ‚ïê‚ïê‚ïê -->
      <div class="gate-overlay" id="gateOverlay">
        <div class="gate-card">

          <!-- Language Toggle -->
          <div class="lang-toggle">
            <div class="lang-toggle-track">
              <button class="lang-toggle-opt active" id="langEN" onclick="setLang('en')">English</button>
              <button class="lang-toggle-opt" id="langES" onclick="setLang('es')">Espa√±ol</button>
            </div>
          </div>

          <div class="gate-icon">üéôÔ∏è</div>
          <div class="gate-title"><span class="hey">Hey</span> Bori</div>
          <div class="gate-subtitle" id="gateSubtitle">Real Conversations</div>
          <div class="gate-price">$14.99<span style="font-size:16px;color:var(--text-3)">/mo</span></div>
          <div class="gate-price-sub" id="gatePriceSub">Cancel anytime</div>
          <div class="gate-features">
            <div class="gate-feat"><span class="gate-feat-check">‚úì</span><span class="feat-text" data-en="Unlimited voice conversations" data-es="Conversaciones de voz ilimitadas">Unlimited voice conversations</span></div>
            <div class="gate-feat"><span class="gate-feat-check">‚úì</span><span class="feat-text" data-en="Bilingual ‚Äî Spanish &amp; English" data-es="Biling√ºe ‚Äî Espa√±ol e Ingl√©s">Bilingual ‚Äî Spanish &amp; English</span></div>
            <div class="gate-feat"><span class="gate-feat-check">‚úì</span><span class="feat-text" data-en="Authentic Puerto Rican companion" data-es="Compa√±ero aut√©ntico puertorrique√±o">Authentic Puerto Rican companion</span></div>
            <div class="gate-feat"><span class="gate-feat-check">‚úì</span><span class="feat-text" data-en="Cultural games included free" data-es="Juegos culturales incluidos gratis">Cultural games included free</span></div>
          </div>
          <button class="gate-btn" id="trialBtn" onclick="startCheckout()">Start 7-Day Free Trial</button>
          <div class="gate-trial-note" id="gateTrialNote">No charge for 7 days. Cancel anytime.</div>

          <div class="gate-divider">
            <div class="gate-divider-line"></div>
            <div class="gate-divider-text" id="gateDividerText">Already a member?</div>
            <div class="gate-divider-line"></div>
          </div>

          <input type="email" class="gate-input" id="gateEmail" placeholder="Enter your email" autocomplete="email" autocapitalize="off">
          <button class="gate-login-btn" id="loginBtn" onclick="checkAccess()">Sign In</button>
          <div class="gate-error" id="gateError"></div>
          <div class="gate-loading" id="gateLoading"><div class="spinner"></div></div>
        </div>
      </div>

      <div id="widgetContainer"></div>
    </div>
  </div>

  <div class="toast" id="toast"></div>

  <script>
// ‚ïê‚ïê‚ïê STATE ‚ïê‚ïê‚ïê
var boriEmail = localStorage.getItem('bori-email') || '';
var boriLang = localStorage.getItem('bori-lang') || 'en';
var boriAccess = null;

// ‚ïê‚ïê‚ïê BILINGUAL TEXT MAP ‚ïê‚ïê‚ïê
var i18n = {
  en: {
    subtitle: 'Real Conversations',
    priceSub: 'Cancel anytime',
    trialBtn: 'Start 7-Day Free Trial',
    trialNote: 'No charge for 7 days. Cancel anytime.',
    divider: 'Already a member?',
    emailPlaceholder: 'Enter your email',
    loginBtn: 'Sign In',
    errorEmail: 'Please enter a valid email.',
    errorNoSub: 'No active subscription found for this email.',
    errorGeneric: 'Something went wrong. Try again.',
    trialBannerText: 'Free trial:',
    trialBannerDays: 'days left',
    trialManage: 'Manage',
    toastWelcome: 'Welcome to Bori Voice! üéôÔ∏è',
    headerSub: 'Real Conversations'
  },
  es: {
    subtitle: 'Conversaciones Reales',
    priceSub: 'Cancela cuando quieras',
    trialBtn: 'Prueba Gratis ‚Äî 7 D√≠as',
    trialNote: 'Sin cargos por 7 d√≠as. Cancela cuando quieras.',
    divider: '¬øYa eres miembro?',
    emailPlaceholder: 'Tu correo electr√≥nico',
    loginBtn: 'Iniciar Sesi√≥n',
    errorEmail: 'Por favor ingresa un correo v√°lido.',
    errorNoSub: 'No se encontr√≥ suscripci√≥n activa con este correo.',
    errorGeneric: 'Algo sali√≥ mal. Intenta de nuevo.',
    trialBannerText: 'Prueba gratis:',
    trialBannerDays: 'd√≠as restantes',
    trialManage: 'Administrar',
    toastWelcome: '¬°Bienvenido a Bori Voice! üéôÔ∏è',
    headerSub: 'Conversaciones Reales'
  }
};

// ‚ïê‚ïê‚ïê LANGUAGE TOGGLE ‚ïê‚ïê‚ïê
function setLang(lang){
  boriLang = lang;
  localStorage.setItem('bori-lang', lang);

  // Toggle buttons
  document.getElementById('langEN').classList.toggle('active', lang === 'en');
  document.getElementById('langES').classList.toggle('active', lang === 'es');

  // Update all text
  var t = i18n[lang];
  document.getElementById('gateSubtitle').textContent = t.subtitle;
  document.getElementById('gatePriceSub').textContent = t.priceSub;
  document.getElementById('trialBtn').textContent = t.trialBtn;
  document.getElementById('gateTrialNote').textContent = t.trialNote;
  document.getElementById('gateDividerText').textContent = t.divider;
  document.getElementById('gateEmail').placeholder = t.emailPlaceholder;
  document.getElementById('loginBtn').textContent = t.loginBtn;
  document.getElementById('hdrSub').textContent = t.headerSub;

  // Feature list
  document.querySelectorAll('.feat-text').forEach(function(el){
    el.textContent = el.getAttribute('data-' + lang);
  });

  // Trial banner
  document.getElementById('trialBannerText').textContent = t.trialBannerText;
  document.getElementById('trialBannerDays').textContent = t.trialBannerDays;
  document.getElementById('trialManageLink').textContent = t.trialManage;
}

// ‚ïê‚ïê‚ïê CHROME DETECTION ‚ïê‚ïê‚ïê
var isChrome = /CriOS|EdgiOS|EdgA|Edg/i.test(navigator.userAgent) || (/Chrome/i.test(navigator.userAgent) && /Mobile/i.test(navigator.userAgent) && !/Safari/i.test(navigator.userAgent));
if(isChrome){document.querySelector('.app').classList.add('is-chrome');}

// ‚ïê‚ïê‚ïê INIT ‚ïê‚ïê‚ïê
(function init(){
  // Set saved language
  setLang(boriLang);

  // Returning from checkout
  if(window.location.search.includes('upgraded=true')){
    showToast(i18n[boriLang].toastWelcome);
    history.replaceState(null,'','/chat');
  }
  if(window.location.search.includes('canceled=true')){
    history.replaceState(null,'','/chat');
  }
  // Auto-check for returning users
  if(boriEmail){
    checkAccessSilent(boriEmail);
  }
})();

// ‚ïê‚ïê‚ïê SILENT ACCESS CHECK (returning users) ‚ïê‚ïê‚ïê
async function checkAccessSilent(email){
  try{
    var res = await fetch('/api/voice/access',{
      method:'POST',
      headers:{'Content-Type':'application/json'},
      body:JSON.stringify({email:email})
    });
    var data = await res.json();
    boriAccess = data;
    if(data.access){
      grantAccess(data);
    }
  }catch(err){
    console.error('[Voice Access Silent]', err);
  }
}

// ‚ïê‚ïê‚ïê CHECK ACCESS (sign-in button) ‚ïê‚ïê‚ïê
async function checkAccess(){
  var t = i18n[boriLang];
  var email = document.getElementById('gateEmail').value.trim().toLowerCase();
  if(!email || !email.includes('@')){
    showGateError(t.errorEmail);
    return;
  }

  document.getElementById('loginBtn').style.display = 'none';
  document.getElementById('gateLoading').style.display = 'block';
  document.getElementById('gateError').style.display = 'none';

  try{
    var res = await fetch('/api/voice/access',{
      method:'POST',
      headers:{'Content-Type':'application/json'},
      body:JSON.stringify({email:email})
    });
    var data = await res.json();
    boriAccess = data;

    if(data.access){
      localStorage.setItem('bori-email', email);
      boriEmail = email;
      grantAccess(data);
    } else {
      showGateError(t.errorNoSub);
      document.getElementById('loginBtn').style.display = 'block';
      document.getElementById('gateLoading').style.display = 'none';
    }
  }catch(err){
    console.error('[Voice Access]', err);
    showGateError(t.errorGeneric);
    document.getElementById('loginBtn').style.display = 'block';
    document.getElementById('gateLoading').style.display = 'none';
  }
}

// ‚ïê‚ïê‚ïê GRANT ACCESS ‚Äî LOAD WIDGET ‚ïê‚ïê‚ïê
function grantAccess(data){
  document.getElementById('gateOverlay').classList.add('hidden');

  var badge = document.getElementById('hdrBadge');
  if(data.reason === 'trial'){
    badge.textContent = data.trialDaysLeft + 'd trial';
    badge.className = 'hdr-badge trial';
    document.getElementById('trialDays').textContent = data.trialDaysLeft;
    document.getElementById('trialBanner').style.display = 'block';
  } else if(data.reason === 'subscriber'){
    badge.textContent = 'Voice';
    badge.className = 'hdr-badge active';
  } else if(data.reason === 'admin'){
    badge.textContent = 'Admin';
    badge.className = 'hdr-badge active';
  }

  if(data.reason !== 'admin'){
    document.getElementById('menuManage').style.display = 'flex';
  }
  document.getElementById('menuLogout').style.display = 'flex';

  loadVoiceWidget();
}

// ‚ïê‚ïê‚ïê LOAD ELEVENLABS WIDGET ‚ïê‚ïê‚ïê
function loadVoiceWidget(){
  var container = document.getElementById('widgetContainer');
  var widget = document.createElement('elevenlabs-convai');
  widget.setAttribute('agent-id','agent_6201kjbe2epdev59wq92kgn49n0r');
  widget.setAttribute('variant','expanded');
  container.appendChild(widget);

  if(!document.querySelector('script[src*="elevenlabs"]')){
    var s = document.createElement('script');
    s.src = 'https://unpkg.com/@elevenlabs/convai-widget-embed';
    s.async = true;
    document.body.appendChild(s);
  }
}

// ‚ïê‚ïê‚ïê START CHECKOUT (Stripe collects email) ‚ïê‚ïê‚ïê
async function startCheckout(){
  var btn = document.getElementById('trialBtn');
  var originalText = btn.textContent;
  btn.disabled = true;
  btn.textContent = '...';

  try{
    var res = await fetch('/api/stripe/checkout',{
      method:'POST',
      headers:{'Content-Type':'application/json'},
      body:JSON.stringify({lang: boriLang})
    });
    var data = await res.json();
    if(data.url){
      window.location.href = data.url;
    } else {
      btn.disabled = false;
      btn.textContent = originalText;
      showToast(i18n[boriLang].errorGeneric);
    }
  }catch(err){
    console.error('[Checkout]',err);
    btn.disabled = false;
    btn.textContent = originalText;
    showToast(i18n[boriLang].errorGeneric);
  }
}

// ‚ïê‚ïê‚ïê OPEN STRIPE PORTAL ‚ïê‚ïê‚ïê
async function openPortal(){
  if(!boriEmail) return;
  try{
    var res = await fetch('/api/stripe/portal',{
      method:'POST',
      headers:{'Content-Type':'application/json'},
      body:JSON.stringify({email:boriEmail})
    });
    var data = await res.json();
    if(data.url) window.location.href = data.url;
    else showToast(i18n[boriLang].errorGeneric);
  }catch(err){
    showToast(i18n[boriLang].errorGeneric);
  }
}

// ‚ïê‚ïê‚ïê LOGOUT ‚ïê‚ïê‚ïê
function logoutUser(){
  localStorage.removeItem('bori-email');
  boriEmail = '';
  boriAccess = null;
  window.location.reload();
}

// ‚ïê‚ïê‚ïê GATE ERROR ‚ïê‚ïê‚ïê
function showGateError(msg){
  var el = document.getElementById('gateError');
  el.textContent = msg;
  el.style.display = 'block';
}

// ‚ïê‚ïê‚ïê ENTER KEY ON EMAIL ‚ïê‚ïê‚ïê
document.getElementById('gateEmail').addEventListener('keydown', function(e){
  if(e.key === 'Enter') checkAccess();
});

// ‚ïê‚ïê‚ïê MENU ‚ïê‚ïê‚ïê
function toggleMenu(){document.getElementById('burger').classList.toggle('open');document.getElementById('menu').classList.toggle('open');document.getElementById('menuOverlay').classList.toggle('open');}

// ‚ïê‚ïê‚ïê SHARE ‚ïê‚ïê‚ïê
function doShare(){var url=window.location.origin;var t=boriLang==='es'?'Habla con Bori ‚Äî tu compa√±ero biling√ºe puertorrique√±o! üáµüá∑üéôÔ∏è '+url:'Talk to Bori ‚Äî your bilingual Puerto Rican AI companion! üáµüá∑üéôÔ∏è '+url;if(navigator.share){navigator.share({title:'Hey Bori',text:t,url:url}).catch(function(){});}else{navigator.clipboard.writeText(t).then(function(){showToast(boriLang==='es'?'¬°Enlace copiado!':'Link copied!');}).catch(function(){});}}

// ‚ïê‚ïê‚ïê TOAST ‚ïê‚ïê‚ïê
function showToast(msg){var t=document.getElementById('toast');t.textContent=msg;t.className='toast show';setTimeout(function(){t.className='toast';},2500);}
  </script>
</body>
</html>
