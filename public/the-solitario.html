<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
<title>Solitario Boricua ‚Äî Hey Bori</title>
<link rel="icon" type="image/png" href="/icon-01F.png">
<link href="https://fonts.googleapis.com/css2?family=Bebas+Neue&family=Outfit:wght@400;600;700;800&display=swap" rel="stylesheet">
<style>
:root {
  --bg: #0a0f0a;
  --felt: #0e1a10;
  --tile-bg: #FAF7F0;
  --tile-border: #C8C0B0;
  --tile-shadow: rgba(0,0,0,0.35);
  --tile-selected: #FFD700;
  --tile-match: #2ECC40;
  --gold: #FFD700;
  --gold-dark: #D4A800;
  --text: #e8e4d9;
  --text-dim: #8a8677;
  --pip: #1a1a1a;
  --sun: #FF6B35;
}

* { margin: 0; padding: 0; box-sizing: border-box; }

html, body {
  height: 100%;
  overflow: hidden;
  touch-action: manipulation;
}

body {
  background: var(--felt);
  background-image:
    radial-gradient(ellipse at 30% 20%, rgba(34,70,22,0.25) 0%, transparent 60%),
    radial-gradient(ellipse at 70% 80%, rgba(34,70,22,0.15) 0%, transparent 50%);
  font-family: 'Outfit', sans-serif;
  color: var(--text);
  user-select: none;
  -webkit-user-select: none;
  -webkit-tap-highlight-color: transparent;
  position: fixed;
  width: 100%;
}

/* ‚ïê‚ïê‚ïê HEADER ‚ïê‚ïê‚ïê */
.header {
  display: flex;
  align-items: center;
  justify-content: space-between;
  padding: 0 12px;
  background: linear-gradient(180deg, rgba(10,18,10,0.97), rgba(10,15,10,0.9));
  border-bottom: 1px solid rgba(255,215,0,0.1);
  height: 50px;
  flex-shrink: 0;
}

.header-left {
  display: flex;
  align-items: center;
  gap: 8px;
}

.header-back {
  background: none;
  border: none;
  color: var(--gold);
  font-size: 22px;
  cursor: pointer;
  padding: 4px 6px;
  line-height: 1;
}

.header-brand {
  display: flex;
  flex-direction: column;
}

.header-title {
  font-family: 'Bebas Neue', sans-serif;
  font-size: 19px;
  letter-spacing: 2px;
  background: linear-gradient(135deg, var(--gold), #FFA000);
  -webkit-background-clip: text;
  -webkit-text-fill-color: transparent;
  background-clip: text;
  line-height: 1.1;
}

.header-sub {
  font-size: 8px;
  color: var(--text-dim);
  letter-spacing: 1.5px;
  text-transform: uppercase;
}

.header-right {
  display: flex;
  align-items: center;
  gap: 12px;
}

.stat {
  text-align: center;
}

.stat-label {
  font-size: 7px;
  color: var(--text-dim);
  text-transform: uppercase;
  letter-spacing: 1px;
  line-height: 1;
}

.stat-value {
  font-family: 'Bebas Neue', sans-serif;
  font-size: 18px;
  color: var(--gold);
  line-height: 1.1;
}

.btn {
  background: linear-gradient(135deg, var(--gold), #FFA000);
  color: #000;
  border: none;
  padding: 7px 14px;
  border-radius: 20px;
  font-family: 'Outfit', sans-serif;
  font-weight: 800;
  font-size: 11px;
  cursor: pointer;
  letter-spacing: 1px;
  text-transform: uppercase;
}
.btn:active { transform: scale(0.93); }

/* ‚ïê‚ïê‚ïê GAME AREA ‚ïê‚ïê‚ïê */
.game-wrap {
  height: calc(100vh - 50px);
  height: calc(100dvh - 50px);
  display: flex;
  flex-direction: column;
  overflow: hidden;
}

/* ‚ïê‚ïê‚ïê BOARD ‚Äî scrollable grid of dominos ‚ïê‚ïê‚ïê */
.board {
  flex: 1;
  overflow-y: auto;
  overflow-x: hidden;
  -webkit-overflow-scrolling: touch;
  padding: 12px 8px 100px;
  display: flex;
  flex-wrap: wrap;
  align-content: flex-start;
  justify-content: center;
  gap: 8px;
}

/* ‚ïê‚ïê‚ïê DOMINO TILE ‚ïê‚ïê‚ïê */
.domino {
  width: 72px;
  height: 120px;
  background: var(--tile-bg);
  border-radius: 10px;
  border: 2px solid var(--tile-border);
  box-shadow: 0 3px 10px var(--tile-shadow), inset 0 1px 0 rgba(255,255,255,0.6);
  display: flex;
  flex-direction: column;
  cursor: pointer;
  transition: transform 0.15s, box-shadow 0.15s, border-color 0.15s;
  position: relative;
  -webkit-tap-highlight-color: transparent;
  flex-shrink: 0;
}

.domino:active:not(.matched):not(.removing) {
  transform: scale(0.95);
}

.domino.selected {
  border-color: var(--tile-selected);
  box-shadow: 0 0 0 3px var(--tile-selected), 0 6px 24px rgba(255,215,0,0.4);
  transform: translateY(-6px) scale(1.03);
  z-index: 10;
}

.domino.hint {
  border-color: var(--sun);
  box-shadow: 0 0 0 2px var(--sun), 0 4px 16px rgba(255,107,53,0.3);
  animation: hintPulse 0.8s ease-in-out 2;
}
@keyframes hintPulse {
  0%,100% { transform: scale(1); }
  50% { transform: scale(1.05); }
}

.domino.matched {
  border-color: var(--tile-match);
  box-shadow: 0 0 0 3px var(--tile-match), 0 6px 24px rgba(46,204,64,0.3);
}

.domino.removing {
  animation: dominoRemove 0.4s ease-in forwards;
  pointer-events: none;
}
@keyframes dominoRemove {
  0% { transform: scale(1); opacity: 1; }
  50% { transform: scale(1.1) rotate(3deg); opacity: 0.8; }
  100% { transform: scale(0) rotate(10deg); opacity: 0; }
}

.domino.face-down {
  background: linear-gradient(145deg, #1c3d22, #122916);
  border-color: rgba(255,215,0,0.15);
  cursor: default;
}

.domino.face-down::after {
  content: 'üå¥';
  position: absolute;
  top: 50%;
  left: 50%;
  transform: translate(-50%, -50%);
  font-size: 24px;
  opacity: 0.3;
}

/* ‚ïê‚ïê‚ïê DOMINO HALVES ‚ïê‚ïê‚ïê */
.domino-half {
  flex: 1;
  display: flex;
  align-items: center;
  justify-content: center;
  position: relative;
}

.domino-divider {
  height: 2px;
  background: linear-gradient(90deg, transparent 8%, #B0A890 8%, #B0A890 92%, transparent 92%);
  flex-shrink: 0;
}

/* ‚ïê‚ïê‚ïê PIP LAYOUTS ‚ïê‚ïê‚ïê */
.pip-area {
  width: 44px;
  height: 44px;
  display: grid;
  grid-template-columns: repeat(3, 1fr);
  grid-template-rows: repeat(3, 1fr);
  gap: 1px;
  align-items: center;
  justify-items: center;
}

.pip {
  width: 10px;
  height: 10px;
  border-radius: 50%;
  background: var(--pip);
  box-shadow: inset 0 -1px 1px rgba(255,255,255,0.15), 0 1px 1px rgba(0,0,0,0.2);
}

/* Blank (0) ‚Äî no pips */

/* ‚ïê‚ïê‚ïê BOTTOM BAR ‚ïê‚ïê‚ïê */
.bottom-bar {
  position: fixed;
  bottom: 0;
  left: 0;
  right: 0;
  height: 72px;
  background: linear-gradient(180deg, rgba(10,18,10,0.95), rgba(8,12,8,0.98));
  border-top: 1px solid rgba(255,215,0,0.1);
  display: flex;
  align-items: center;
  justify-content: space-around;
  padding: 0 12px;
  z-index: 50;
}

.bar-btn {
  display: flex;
  flex-direction: column;
  align-items: center;
  gap: 3px;
  background: none;
  border: none;
  color: var(--text-dim);
  cursor: pointer;
  padding: 6px 14px;
  border-radius: 12px;
  transition: all 0.15s;
  font-family: 'Outfit', sans-serif;
}
.bar-btn:active { background: rgba(255,215,0,0.08); }
.bar-btn-icon { font-size: 22px; }
.bar-btn-label { font-size: 9px; font-weight: 700; letter-spacing: 0.5px; text-transform: uppercase; }

.bar-btn.active { color: var(--gold); }

.bar-remaining {
  display: flex;
  flex-direction: column;
  align-items: center;
  gap: 1px;
}
.bar-remaining-count {
  font-family: 'Bebas Neue', sans-serif;
  font-size: 24px;
  color: var(--gold);
  line-height: 1;
}
.bar-remaining-label {
  font-size: 8px;
  color: var(--text-dim);
  text-transform: uppercase;
  letter-spacing: 1px;
  font-weight: 700;
}

/* ‚ïê‚ïê‚ïê WIN OVERLAY ‚ïê‚ïê‚ïê */
.overlay {
  display: none;
  position: fixed;
  inset: 0;
  background: rgba(0,0,0,0.88);
  z-index: 9999;
  justify-content: center;
  align-items: center;
  flex-direction: column;
  gap: 16px;
}
.overlay.show { display: flex; }

.overlay-title {
  font-family: 'Bebas Neue', sans-serif;
  font-size: 52px;
  background: linear-gradient(135deg, var(--gold), #FFA000, var(--gold));
  -webkit-background-clip: text;
  -webkit-text-fill-color: transparent;
  background-clip: text;
  letter-spacing: 4px;
  animation: pulse 1.5s ease infinite;
}
@keyframes pulse { 0%,100%{transform:scale(1)} 50%{transform:scale(1.06)} }

.overlay-stats {
  color: var(--text-dim);
  font-size: 15px;
  text-align: center;
  line-height: 2;
}
.overlay-stats span { color: var(--gold); font-weight: 700; }

.overlay-btn {
  background: linear-gradient(135deg, var(--gold), #FFA000);
  color: #000;
  border: none;
  padding: 14px 36px;
  border-radius: 30px;
  font-family: 'Outfit', sans-serif;
  font-weight: 800;
  font-size: 16px;
  cursor: pointer;
  letter-spacing: 1px;
  text-transform: uppercase;
}

/* ‚ïê‚ïê‚ïê FACT TOAST ‚ïê‚ïê‚ïê */
.toast {
  position: fixed;
  bottom: 84px;
  left: 50%;
  transform: translateX(-50%) translateY(80px);
  background: linear-gradient(135deg, rgba(13,31,18,0.97), rgba(0,0,0,0.95));
  border: 1px solid rgba(255,215,0,0.2);
  border-radius: 12px;
  padding: 10px 16px;
  max-width: min(340px, 88vw);
  text-align: center;
  font-size: 12px;
  color: var(--text);
  z-index: 200;
  transition: transform 0.4s cubic-bezier(0.34, 1.56, 0.64, 1);
  pointer-events: none;
}
.toast.show { transform: translateX(-50%) translateY(0); }
.toast-label {
  color: var(--gold);
  font-family: 'Bebas Neue', sans-serif;
  font-size: 10px;
  letter-spacing: 2px;
  margin-bottom: 2px;
}

/* ‚ïê‚ïê‚ïê HOW TO PLAY DROPDOWN ‚ïê‚ïê‚ïê */
.help-dropdown {
  position: fixed;
  bottom: 72px;
  left: 0;
  right: 0;
  z-index: 200;
  transform: translateY(120%);
  transition: transform 0.35s cubic-bezier(0.22, 1, 0.36, 1);
  pointer-events: none;
}
.help-dropdown.show {
  transform: translateY(0);
  pointer-events: auto;
}

.help-backdrop {
  display: none;
  position: fixed;
  inset: 0;
  background: rgba(0,0,0,0.5);
  z-index: 199;
}
.help-backdrop.show { display: block; }

.help-box {
  background: linear-gradient(180deg, rgba(14,26,16,0.98), rgba(8,14,8,0.99));
  border-top: 1.5px solid rgba(255,215,0,0.2);
  border-radius: 20px 20px 0 0;
  padding: 20px 20px 28px;
  max-height: 65vh;
  overflow-y: auto;
  -webkit-overflow-scrolling: touch;
}

.help-handle {
  width: 36px;
  height: 4px;
  background: rgba(255,215,0,0.25);
  border-radius: 2px;
  margin: 0 auto 14px;
}

.help-title {
  font-family: 'Bebas Neue', sans-serif;
  font-size: 24px;
  color: var(--gold);
  letter-spacing: 2px;
  text-align: center;
  margin-bottom: 4px;
}

/* Language toggle inside help */
.help-lang {
  display: flex;
  justify-content: center;
  gap: 0;
  margin-bottom: 16px;
  border-radius: 8px;
  overflow: hidden;
  border: 1.5px solid rgba(255,215,0,0.2);
  width: fit-content;
  margin-left: auto;
  margin-right: auto;
}

.help-lang-btn {
  padding: 6px 20px;
  font-family: 'Outfit', sans-serif;
  font-size: 12px;
  font-weight: 800;
  border: none;
  cursor: pointer;
  background: transparent;
  color: var(--text-dim);
  transition: all 0.2s;
  letter-spacing: 0.5px;
}

.help-lang-btn.active {
  background: var(--gold);
  color: #000;
}

.help-content { display: none; }
.help-content.active { display: block; }

.help-text {
  font-size: 14px;
  color: var(--text);
  line-height: 1.8;
  font-weight: 600;
  text-align: center;
}

.help-text strong { color: var(--gold); }

.help-example {
  display: flex;
  align-items: center;
  justify-content: center;
  gap: 10px;
  margin: 14px 0;
  padding: 12px;
  background: rgba(255,255,255,0.04);
  border-radius: 10px;
  border: 1px solid rgba(255,215,0,0.08);
}

.help-mini-tile {
  background: var(--tile-bg);
  border-radius: 6px;
  border: 1.5px solid var(--tile-border);
  padding: 6px 10px;
  font-size: 16px;
  font-weight: 800;
  color: var(--pip);
  text-align: center;
  line-height: 1.3;
  box-shadow: 0 2px 6px rgba(0,0,0,0.2);
}

.help-mini-tile .hd { 
  border-top: 1.5px solid #B0A890; 
  margin-top: 4px; 
  padding-top: 4px; 
}

.help-plus {
  font-family: 'Bebas Neue', sans-serif;
  font-size: 22px;
  color: var(--gold);
}

.help-equals {
  font-family: 'Bebas Neue', sans-serif;
  font-size: 18px;
  color: var(--tile-match);
}

/* ‚ïê‚ïê‚ïê RESPONSIVE ‚ïê‚ïê‚ïê */
@media (min-width: 420px) {
  .domino { width: 80px; height: 132px; }
  .pip-area { width: 50px; height: 50px; }
  .pip { width: 12px; height: 12px; }
}

@media (min-width: 520px) {
  .domino { width: 88px; height: 144px; border-radius: 12px; }
  .pip-area { width: 54px; height: 54px; }
  .pip { width: 13px; height: 13px; }
}
</style>
</head>
<body>

<div class="header">
  <div class="header-left">
    <button class="header-back" onclick="window.location.href='/'">‚Üê</button>
    <div class="header-brand">
      <div class="header-title">SOLITARIO BORICUA</div>
      <div class="header-sub">Hey Bori Games</div>
    </div>
  </div>
  <div class="header-right">
    <div class="stat">
      <div class="stat-label">Pairs</div>
      <div class="stat-value" id="pairsCount">0</div>
    </div>
    <div class="stat">
      <div class="stat-label">Time</div>
      <div class="stat-value" id="timer">0:00</div>
    </div>
    <button class="btn" onclick="newGame()">NUEVA</button>
  </div>
</div>

<div class="game-wrap">
  <div class="board" id="board"></div>
</div>

<!-- BOTTOM BAR -->
<div class="bottom-bar">
  <button class="bar-btn" onclick="undoMove()">
    <span class="bar-btn-icon">‚Ü©</span>
    <span class="bar-btn-label">Undo</span>
  </button>
  <div class="bar-remaining">
    <div class="bar-remaining-count" id="remaining">28</div>
    <div class="bar-remaining-label">Tiles Left</div>
  </div>
  <button class="bar-btn" onclick="showHint()">
    <span class="bar-btn-icon">üí°</span>
    <span class="bar-btn-label">Hint</span>
  </button>
  <button class="bar-btn" onclick="toggleHelp()">
    <span class="bar-btn-icon">?</span>
    <span class="bar-btn-label">How</span>
  </button>
</div>

<!-- WIN -->
<div class="overlay" id="winOverlay">
  <div class="overlay-title">¬°WEPA!</div>
  <div class="overlay-stats">
    Pairs: <span id="winPairs">0</span><br>
    Time: <span id="winTime">0:00</span>
  </div>
  <button class="overlay-btn" onclick="newGame()">JUGAR OTRA VEZ</button>
</div>

<!-- STUCK -->
<div class="overlay" id="stuckOverlay">
  <div class="overlay-title" style="font-size:36px">NO MOVES LEFT</div>
  <div class="overlay-stats">
    You cleared <span id="stuckPairs">0</span> pairs!<br>
    <span id="stuckLeft">0</span> tiles remained
  </div>
  <button class="overlay-btn" onclick="newGame()">TRY AGAIN</button>
</div>

<!-- HOW TO PLAY DROPDOWN -->
<div class="help-backdrop" id="helpBackdrop" onclick="toggleHelp()"></div>
<div class="help-dropdown" id="helpDropdown">
  <div class="help-box">
    <div class="help-handle"></div>
    <div class="help-title">HOW TO PLAY</div>
    <div class="help-lang">
      <button class="help-lang-btn active" id="helpEn" onclick="setHelpLang('en')">English</button>
      <button class="help-lang-btn" id="helpEs" onclick="setHelpLang('es')">Espa√±ol</button>
    </div>

    <!-- ENGLISH -->
    <div class="help-content active" id="helpContentEn">
      <div class="help-text">
        Tap two dominoes whose<br><strong>total pips add up to 12</strong>.
      </div>
      <div class="help-example">
        <div class="help-mini-tile">4<div class="hd">2</div></div>
        <div class="help-plus">+</div>
        <div class="help-mini-tile">5<div class="hd">1</div></div>
        <div class="help-equals">= 12 ‚úì</div>
      </div>
      <div class="help-text">
        The first tile has <strong>6 pips</strong> (4+2).<br>
        The second has <strong>6 pips</strong> (5+1).<br>
        6 + 6 = 12. <strong>¬°Match!</strong><br><br>
        <strong>Doubles totaling 12</strong> (like 6|6)<br>remove with a single tap.<br><br>
        Use <strong>üí° Hint</strong> if you're stuck.<br>
        Use <strong>‚Ü© Undo</strong> to take back a move.<br><br>
        Clear all <strong>28 dominoes</strong> to win. üáµüá∑
      </div>
    </div>

    <!-- ESPA√ëOL -->
    <div class="help-content" id="helpContentEs">
      <div class="help-text">
        Toca dos fichas de domin√≥ cuyo<br><strong>total de puntos sume 12</strong>.
      </div>
      <div class="help-example">
        <div class="help-mini-tile">4<div class="hd">2</div></div>
        <div class="help-plus">+</div>
        <div class="help-mini-tile">5<div class="hd">1</div></div>
        <div class="help-equals">= 12 ‚úì</div>
      </div>
      <div class="help-text">
        La primera ficha tiene <strong>6 puntos</strong> (4+2).<br>
        La segunda tiene <strong>6 puntos</strong> (5+1).<br>
        6 + 6 = 12. <strong>¬°Match!</strong><br><br>
        <strong>Dobles que sumen 12</strong> (como 6|6)<br>se quitan con un solo toque.<br><br>
        Usa <strong>üí° Pista</strong> si te trabas.<br>
        Usa <strong>‚Ü© Deshacer</strong> para retroceder.<br><br>
        Elimina las <strong>28 fichas</strong> para ganar. üáµüá∑
      </div>
    </div>
  </div>
</div>

<!-- TOAST -->
<div class="toast" id="toast">
  <div class="toast-label">¬øSAB√çAS?</div>
  <div id="toastText"></div>
</div>

<script>
// ‚ïê‚ïê‚ïê PIP POSITIONS ‚ïê‚ïê‚ïê
// Grid: 3x3. Positions are [row, col] (0-indexed)
const PIP_POSITIONS = {
  0: [],
  1: [[1,1]],
  2: [[0,2],[2,0]],
  3: [[0,2],[1,1],[2,0]],
  4: [[0,0],[0,2],[2,0],[2,2]],
  5: [[0,0],[0,2],[1,1],[2,0],[2,2]],
  6: [[0,0],[0,2],[1,0],[1,2],[2,0],[2,2]]
};

// ‚ïê‚ïê‚ïê PR FACTS ‚ïê‚ïê‚ïê
const FACTS = [
  "Puerto Rico has 78 municipios, each with its own flag and coat of arms.",
  "El Yunque is the only tropical rainforest in the US National Forest System.",
  "The coqu√≠ frog is found nowhere else on Earth.",
  "Ponce is known as 'La Perla del Sur' ‚Äî The Pearl of the South.",
  "Mofongo was created by enslaved Africans adapting West African fufu.",
  "Arecibo once housed the world's largest radio telescope.",
  "Bomba y plena originated in Lo√≠za and Ponce respectively.",
  "San Juan is the oldest city under US jurisdiction, founded in 1521.",
  "Pi√±a colada was invented in San Juan in 1954.",
  "Puerto Rico has over 270 miles of coastline.",
  "Camuy has one of the largest cave systems in the Western Hemisphere.",
  "Caf√© from Yauco is considered among the finest in the world.",
  "Vieques has Mosquito Bay ‚Äî the brightest bioluminescent bay on Earth.",
  "Roberto Clemente was the first Latino in the Baseball Hall of Fame.",
  "Culebra's Flamenco Beach is consistently ranked among the world's best.",
  "Puerto Rico's national tree is the ceiba."
];
let factIdx = 0;

// ‚ïê‚ïê‚ïê GAME STATE ‚ïê‚ïê‚ïê
const TARGET = 12;
let tiles = [];
let selectedIdx = null;
let pairs = 0;
let timerInterval = null;
let seconds = 0;
let undoStack = [];
let gameOver = false;

// ‚ïê‚ïê‚ïê CREATE DOMINO SET ‚ïê‚ïê‚ïê
function createDominoes() {
  const set = [];
  for (let a = 0; a <= 6; a++) {
    for (let b = a; b <= 6; b++) {
      set.push({ top: a, bottom: b, total: a + b, removed: false, id: `${a}-${b}` });
    }
  }
  return set;
}

function shuffle(arr) {
  for (let i = arr.length - 1; i > 0; i--) {
    const j = Math.floor(Math.random() * (i + 1));
    [arr[i], arr[j]] = [arr[j], arr[i]];
  }
  return arr;
}

// ‚ïê‚ïê‚ïê NEW GAME ‚ïê‚ïê‚ïê
function newGame() {
  document.getElementById('winOverlay').classList.remove('show');
  document.getElementById('stuckOverlay').classList.remove('show');
  clearInterval(timerInterval);

  tiles = shuffle(createDominoes());
  selectedIdx = null;
  pairs = 0;
  seconds = 0;
  undoStack = [];
  gameOver = false;

  updateUI();
  render();
  startTimer();

  setTimeout(showFact, 2000);
}

function startTimer() {
  timerInterval = setInterval(() => {
    seconds++;
    document.getElementById('timer').textContent =
      Math.floor(seconds/60) + ':' + String(seconds%60).padStart(2,'0');
  }, 1000);
}

function updateUI() {
  document.getElementById('pairsCount').textContent = pairs;
  const left = tiles.filter(t => !t.removed).length;
  document.getElementById('remaining').textContent = left;
}

// ‚ïê‚ïê‚ïê RENDER ‚ïê‚ïê‚ïê
function render() {
  const board = document.getElementById('board');
  board.innerHTML = '';

  tiles.forEach((tile, idx) => {
    if (tile.removed) return;

    const el = document.createElement('div');
    el.className = 'domino';
    if (idx === selectedIdx) el.classList.add('selected');
    el.dataset.idx = idx;

    // Top half
    const topHalf = document.createElement('div');
    topHalf.className = 'domino-half';
    topHalf.appendChild(createPipArea(tile.top));

    // Divider
    const divider = document.createElement('div');
    divider.className = 'domino-divider';

    // Bottom half
    const bottomHalf = document.createElement('div');
    bottomHalf.className = 'domino-half';
    bottomHalf.appendChild(createPipArea(tile.bottom));

    el.appendChild(topHalf);
    el.appendChild(divider);
    el.appendChild(bottomHalf);

    el.addEventListener('click', () => onTileTap(idx));

    board.appendChild(el);
  });

  updateUI();
}

function createPipArea(n) {
  const area = document.createElement('div');
  area.className = 'pip-area';

  // Create 9 cells (3x3)
  const positions = PIP_POSITIONS[n] || [];
  for (let r = 0; r < 3; r++) {
    for (let c = 0; c < 3; c++) {
      const cell = document.createElement('div');
      const hasPip = positions.some(p => p[0] === r && p[1] === c);
      if (hasPip) {
        cell.className = 'pip';
      }
      area.appendChild(cell);
    }
  }

  return area;
}

// ‚ïê‚ïê‚ïê TAP LOGIC ‚ïê‚ïê‚ïê
function onTileTap(idx) {
  if (gameOver) return;

  const tile = tiles[idx];
  if (tile.removed) return;

  // Self-match: double that equals TARGET
  if (tile.total === TARGET) {
    // save for undo
    undoStack.push({ type: 'single', idx, tile: {...tile} });
    if (undoStack.length > 30) undoStack.shift();

    tile.removed = true;
    pairs++;
    animateRemove(idx);
    selectedIdx = null;
    return;
  }

  // Nothing selected yet ‚Äî select this tile
  if (selectedIdx === null) {
    selectedIdx = idx;
    render();
    return;
  }

  // Tapped same tile ‚Äî deselect
  if (selectedIdx === idx) {
    selectedIdx = null;
    render();
    return;
  }

  // Check match
  const other = tiles[selectedIdx];
  if (tile.total + other.total === TARGET) {
    // Match!
    undoStack.push({
      type: 'pair',
      idx1: selectedIdx, tile1: {...other},
      idx2: idx, tile2: {...tile}
    });
    if (undoStack.length > 30) undoStack.shift();

    other.removed = true;
    tile.removed = true;
    pairs++;
    animateRemove(selectedIdx, idx);
    selectedIdx = null;
  } else {
    // No match ‚Äî select new tile
    selectedIdx = idx;
    render();
  }
}

function animateRemove(...indices) {
  const board = document.getElementById('board');
  const els = board.querySelectorAll('.domino');

  els.forEach(el => {
    const i = parseInt(el.dataset.idx);
    if (indices.includes(i)) {
      el.classList.add('matched');
      setTimeout(() => {
        el.classList.add('removing');
      }, 200);
    }
  });

  setTimeout(() => {
    render();
    checkWin();
    if (pairs % 3 === 0 && pairs > 0) showFact();
  }, 600);
}

// ‚ïê‚ïê‚ïê UNDO ‚ïê‚ïê‚ïê
function undoMove() {
  if (undoStack.length === 0 || gameOver) return;

  const last = undoStack.pop();
  if (last.type === 'single') {
    tiles[last.idx].removed = false;
    pairs--;
  } else {
    tiles[last.idx1].removed = false;
    tiles[last.idx2].removed = false;
    pairs--;
  }
  selectedIdx = null;
  render();
}

// ‚ïê‚ïê‚ïê HINT ‚ïê‚ïê‚ïê
function showHint() {
  if (gameOver) return;

  const active = tiles.map((t, i) => ({...t, i})).filter(t => !t.removed);

  // Find a self-match first
  for (const t of active) {
    if (t.total === TARGET) {
      highlightHint(t.i);
      return;
    }
  }

  // Find a pair
  for (let a = 0; a < active.length; a++) {
    for (let b = a + 1; b < active.length; b++) {
      if (active[a].total + active[b].total === TARGET) {
        highlightHint(active[a].i, active[b].i);
        return;
      }
    }
  }

  // No moves
  showToast("No moves available!");
}

function highlightHint(...indices) {
  const board = document.getElementById('board');
  board.querySelectorAll('.domino').forEach(el => {
    const i = parseInt(el.dataset.idx);
    if (indices.includes(i)) {
      el.classList.add('hint');
      setTimeout(() => el.classList.remove('hint'), 1600);
    }
  });
}

// ‚ïê‚ïê‚ïê WIN / STUCK CHECK ‚ïê‚ïê‚ïê
function checkWin() {
  const remaining = tiles.filter(t => !t.removed);

  if (remaining.length === 0) {
    gameOver = true;
    clearInterval(timerInterval);
    document.getElementById('winPairs').textContent = pairs;
    document.getElementById('winTime').textContent = document.getElementById('timer').textContent;
    setTimeout(() => document.getElementById('winOverlay').classList.add('show'), 300);
    return;
  }

  // Check if any moves exist
  const active = remaining;

  for (const t of active) {
    if (t.total === TARGET) return; // self-match exists
  }

  for (let a = 0; a < active.length; a++) {
    for (let b = a + 1; b < active.length; b++) {
      if (active[a].total + active[b].total === TARGET) return; // pair exists
    }
  }

  // No moves left
  gameOver = true;
  clearInterval(timerInterval);
  document.getElementById('stuckPairs').textContent = pairs;
  document.getElementById('stuckLeft').textContent = remaining.length;
  setTimeout(() => document.getElementById('stuckOverlay').classList.add('show'), 500);
}

// ‚ïê‚ïê‚ïê HELP ‚ïê‚ïê‚ïê
function toggleHelp() {
  const dropdown = document.getElementById('helpDropdown');
  const backdrop = document.getElementById('helpBackdrop');
  dropdown.classList.toggle('show');
  backdrop.classList.toggle('show');
}

function setHelpLang(lang) {
  document.getElementById('helpEn').className = 'help-lang-btn' + (lang === 'en' ? ' active' : '');
  document.getElementById('helpEs').className = 'help-lang-btn' + (lang === 'es' ? ' active' : '');
  document.getElementById('helpContentEn').className = 'help-content' + (lang === 'en' ? ' active' : '');
  document.getElementById('helpContentEs').className = 'help-content' + (lang === 'es' ? ' active' : '');
}

// ‚ïê‚ïê‚ïê FACTS ‚ïê‚ïê‚ïê
function showFact() {
  const toast = document.getElementById('toast');
  document.getElementById('toastText').textContent = FACTS[factIdx % FACTS.length];
  factIdx++;
  toast.classList.add('show');
  setTimeout(() => toast.classList.remove('show'), 4000);
}

function showToast(msg) {
  const toast = document.getElementById('toast');
  document.getElementById('toastText').textContent = msg;
  toast.querySelector('.toast-label').textContent = '';
  toast.classList.add('show');
  setTimeout(() => {
    toast.classList.remove('show');
    toast.querySelector('.toast-label').textContent = '¬øSAB√çAS?';
  }, 2500);
}

// ‚ïê‚ïê‚ïê START ‚ïê‚ïê‚ïê
newGame();
</script>
</body>
</html>
